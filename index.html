<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì—°ì˜ˆ í€´ì¦ˆíŒ¡</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- RSS í”„ë¡ì‹œ ì‚¬ì „ ì—°ê²° -->
  <link rel="preconnect" href="https://api.allorigins.win" crossorigin>
  <link rel="preconnect" href="https://api.codetabs.com" crossorigin>
  <link rel="preconnect" href="https://r.jina.ai" crossorigin>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Noto Sans KR', sans-serif; }
    .quiz-card { transition: all 0.3s ease; }
    .quiz-card:hover { transform: translateY(-2px); }
    .progress-bar { transition: width 0.5s ease; }
    .tooltip { animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .medal-gold { color: #FFD700; }
    .medal-silver { color: #C0C0C0; }
    .medal-bronze { color: #CD7F32; }
    .skeleton { position: relative; overflow: hidden; background: #f3f4f6; }
    .skeleton::after { content: ''; position: absolute; inset: 0; transform: translateX(-100%); background: linear-gradient(90deg, transparent, rgba(0,0,0,.04), transparent); animation: shimmer 1.2s infinite; }
    @keyframes shimmer { 100% { transform: translateX(100%); } }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
  <!-- í™ˆ í™”ë©´ -->
  <div id="home-screen" class="container mx-auto px-4 py-8">
    <div class="text-center mb-12">
      <h1 class="text-5xl font-bold text-purple-800 mb-2">ì—°ì˜ˆ í€´ì¦ˆíŒ¡</h1>
      <p class="text-xl text-gray-600 opacity-80">ê¸°ì‚¬ ì† ì •ë‹µì„ ì°¾ì•„ë¼!</p>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ -->
    <div class="max-w-4xl mx-auto mb-12">
      <div class="grid grid-cols-3 gap-6 mb-6">
        <button onclick="selectCategory('ì•„ì´ëŒ')" class="quiz-card bg-gradient-to-r from-pink-400 to-purple-500 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl"><div class="text-3xl mb-2">ğŸ¤</div><div class="text-xl font-semibold">ì•„ì´ëŒ</div></button>
        <button onclick="selectCategory('ë“œë¼ë§ˆ')" class="quiz-card bg-gradient-to-r from-blue-400 to-indigo-500 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl"><div class="text-3xl mb-2">ğŸ“º</div><div class="text-xl font-semibold">ë“œë¼ë§ˆ</div></button>
        <button onclick="selectCategory('ì˜í™”')" class="quiz-card bg-gradient-to-r from-green-400 to-teal-500 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl"><div class="text-3xl mb-2">ğŸ¬</div><div class="text-xl font-semibold">ì˜í™”</div></button>
      </div>
      <div class="grid grid-cols-3 gap-6">
        <button onclick="selectCategory('ì˜ˆëŠ¥')" class="quiz-card bg-gradient-to-r from-orange-400 to-red-500 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl"><div class="text-3xl mb-2">ğŸª</div><div class="text-xl font-semibold">ì˜ˆëŠ¥</div></button>
        <button onclick="selectCategory('ìŠ¤íƒ€')" class="quiz-card bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl"><div class="text-3xl mb-2">â­</div><div class="text-xl font-semibold">ìŠ¤íƒ€</div></button>
        <button onclick="selectCategory('í•´ì™¸')" class="quiz-card bg-gradient-to-r from-purple-400 to-pink-500 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl"><div class="text-3xl mb-2">ğŸŒ</div><div class="text-xl font-semibold">í•´ì™¸</div></button>
      </div>
    </div>

    <!-- ëˆ„ì  ì°¸ì—¬ìˆ˜ -->
    <div class="text-center mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg max-w-md mx-auto">
        <h3 class="text-lg font-semibold text-gray-700 mb-2">ëˆ„ì  ì°¸ì—¬ìˆ˜</h3>
        <div class="text-3xl font-bold text-purple-600" id="total-participants">1,000ëª…</div>
      </div>
    </div>

    <!-- ì „ì²´ ë­í‚¹ TOP 5 -->
    <div class="bg-white rounded-xl p-6 shadow-lg max-ww-2xl max-w-2xl mx-auto mb-8">
      <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ğŸ† ì „ì²´ ë­í‚¹ TOP 5</h3>
      <div id="today-ranking"></div>
    </div>
  </div>

  <!-- ë‹‰ë„¤ì„ ì…ë ¥ -->
  <div id="nickname-screen" class="hidden container mx-auto px-4 py-8">
    <div class="flex justify-start mb-6">
      <button onclick="goHome()" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg transition-colors">ğŸ  í™ˆìœ¼ë¡œ</button>
    </div>
    <div class="max-w-md mx-auto bg-white rounded-xl p-8 shadow-lg">
      <h2 class="text-2xl font-bold text-center mb-6 text-purple-800">ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</h2>
      <div class="mb-6">
        <input id="nickname-input" type="text" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full p-4 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:outline-none text-lg"/>
      </div>
      <button onclick="startQuiz()" class="w-full bg-purple-500 text-white py-4 rounded-lg text-lg font-semibold hover:bg-purple-600 transition-colors">í€´ì¦ˆ ì‹œì‘í•˜ê¸°</button>
    </div>
  </div>

  <!-- í€´ì¦ˆ í’€ê¸° -->
  <div id="quiz-screen" class="hidden container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-6">
      <button onclick="goHome()" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg transition-colors">ğŸ  í™ˆìœ¼ë¡œ</button>
      <h2 class="text-xl font-semibold text-purple-800" id="quiz-header">ì•„ì´ëŒ í€´ì¦ˆ - ë‹‰ë„¤ì„</h2>
      <div></div>
    </div>

    <div class="mb-8">
      <div class="w-full bg-gray-200 rounded-full h-3">
        <div class="progress-bar bg-purple-500 h-3 rounded-full" id="progress-bar" style="width: 16.67%"></div>
      </div>
      <div class="text-center mt-2">
        <span class="text-sm text-gray-600 font-medium" id="progress-text">1/6</span>
      </div>
    </div>

    <div class="bg-white rounded-xl p-8 shadow-lg mb-6">
      <div class="flex items-start justify-between mb-6">
        <h3 class="text-xl font-semibold text-gray-800 flex-1" id="question-text">ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</h3>
        <button onclick="showHint()" class="bg-yellow-400 hover:bg-yellow-500 text-white px-4 py-2 rounded-lg ml-4 transition-colors">ğŸ’¡ íŒíŠ¸ë³´ê¸°</button>
      </div>
      <div class="space-y-3" id="options-container"></div>
    </div>

    <div id="answer-tooltip" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-6 py-3 rounded-lg text-white font-semibold text-lg z-50"></div>
  </div>

  <!-- ê²°ê³¼ í™”ë©´ -->
  <div id="result-screen" class="hidden container mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-purple-800 mb-4" id="result-title">ì•„ì´ëŒ í€´ì¦ˆ í’€ê¸° ì™„ë£Œ!</h2>
      <div class="text-2xl font-semibold text-gray-700 mb-2" id="result-score">ë‹‰ë„¤ì„ë‹˜ì˜ ì ìˆ˜: 85ì  (ì •ë‹µ 5/6)</div>
      <div class="text-lg text-gray-600" id="result-message">í›Œë¥­í•´ìš”! ì—°ì˜ˆê³„ ì†Œì‹ì— ê´€ì‹¬ì´ ë§ìœ¼ì‹œë„¤ìš”! ğŸŒŸ</div>
    </div>

    <div class="flex justify-center space-x-4 mb-12">
      <button onclick="retryQuiz()" class="bg-purple-500 hover:bg-purple-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors">ë‹¤ì‹œ í’€ê¸°</button>
      <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold transition-colors">í™ˆìœ¼ë¡œ ê°€ê¸°</button>
    </div>

    <!-- ì „ì²´ ë­í‚¹ TOP 10 -->
    <div class="bg-white rounded-xl p-6 shadow-lg max-w-2xl mx-auto mb-8">
      <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ğŸ† ì „ì²´ ë­í‚¹ TOP 10</h3>
      <div id="overall-ranking-10"></div>
    </div>

    <!-- ì‹¤ì‹œê°„ ì¶”ì²œ ë‰´ìŠ¤ -->
    <div class="bg-white rounded-xl p-6 shadow-lg max-w-2xl mx-auto">
      <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“° ì‹¤ì‹œê°„ ì¶”ì²œ ë‰´ìŠ¤</h3>
      <div id="news-container" class="space-y-4"></div>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ -->
  <div id="admin-login-screen" class="hidden container mx-auto px-4 py-12">
    <div class="max-w-sm mx-auto bg-white rounded-xl p-8 shadow-lg">
      <h2 class="text-2xl font-bold text-center mb-6 text-purple-800">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
      <div class="space-y-4">
        <div><label class="block text-sm text-gray-700 mb-1">ì•„ì´ë””</label><input id="admin-login-id" type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="ì•„ì´ë””"/></div>
        <div><label class="block text-sm text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label><input id="admin-login-pw" type="password" class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="ë¹„ë°€ë²ˆí˜¸"/></div>
        <button onclick="loginAdmin()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg font-semibold transition-colors">ë¡œê·¸ì¸</button>
        <button onclick="goHome()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-lg font-semibold transition-colors">í™ˆìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ëª©ë¡ -->
  <div id="admin-screen" class="hidden container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold text-purple-800">ê´€ë¦¬ì í˜ì´ì§€</h2>
        <div class="flex items-center gap-2">
          <button onclick="logoutAdmin()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-2 rounded-lg transition-colors">ë¡œê·¸ì•„ì›ƒ</button>
          <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">í™ˆìœ¼ë¡œ</button>
        </div>
      </div>

      <div class="bg-white rounded-xl p-8 shadow-lg">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold">ì¹´í…Œê³ ë¦¬ë³„ í€´ì¦ˆ ê´€ë¦¬</h3>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-gray-300">
            <thead>
              <tr class="bg-gray-50">
                <th class="border border-gray-300 px-4 py-3 text-left">ì¹´í…Œê³ ë¦¬</th>
                <th class="border border-gray-300 px-4 py-3 text-center">í€´ì¦ˆ ê°œìˆ˜</th>
                <th class="border border-gray-300 px-4 py-3 text-center">ìµœê·¼ ìˆ˜ì •ì¼ì‹œ</th>
                <th class="border border-gray-300 px-4 py-3 text-center">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody id="category-table"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ -->
  <div id="admin-create-screen" class="hidden container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
      <div class="flex items-center justify-between mb-8">
        <h2 id="admin-create-title" class="text-3xl font-bold text-purple-800">í€´ì¦ˆ ì—…ë°ì´íŠ¸</h2>
        <button onclick="showAdminList()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">ë’¤ë¡œê°€ê¸°</button>
      </div>

      <div class="bg-white rounded-xl p-8 shadow-lg">
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">í€´ì¦ˆ ë°ì´í„° (JSON only, 4ì§€ì„ ë‹¤)</label>
          <textarea id="admin-quiz-json" rows="15" class="w-full p-3 border border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none font-mono text-sm"
placeholder='{
  "ì¹´í…Œê³ ë¦¬": "ì•„ì´ëŒ",
  "quizzes": [
    { "question": "ë¬¸ì œ1", "options": ["ë³´ê¸°1","ë³´ê¸°2","ë³´ê¸°3","ë³´ê¸°4"], "correctIndex": 0, "hintUrl": "https://...", "meta": {} },
    { "question": "ë¬¸ì œ2", "options": ["ë³´ê¸°1","ë³´ê¸°2","ë³´ê¸°3","ë³´ê¸°4"], "correctIndex": 1, "hintUrl": "https://...", "meta": {} },
    { "question": "ë¬¸ì œ3", "options": ["ë³´ê¸°1","ë³´ê¸°2","ë³´ê¸°3","ë³´ê¸°4"], "correctIndex": 2, "hintUrl": "https://...", "meta": {} },
    { "question": "ë¬¸ì œ4", "options": ["ë³´ê¸°1","ë³´ê¸°2","ë³´ê¸°3","ë³´ê¸°4"], "correctIndex": 3, "hintUrl": "https://...", "meta": {} },
    { "question": "ë¬¸ì œ5", "options": ["ë³´ê¸°1","ë³´ê¸°2","ë³´ê¸°3","ë³´ê¸°4"], "correctIndex": 0, "hintUrl": "https://...", "meta": {} },
    { "question": "ë¬¸ì œ6", "options": ["ë³´ê¸°1","ë³´ê¸°2","ë³´ê¸°3","ë³´ê¸°4"], "correctIndex": 1, "hintUrl": "https://...", "meta": {} }
  ]
}'></textarea>
          <p class="text-sm text-gray-500 mt-2">â€» JSONì— ì¹´í…Œê³ ë¦¬ê°€ ì—†ì–´ë„, ëª©ë¡ì—ì„œ ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
        </div>

        <div class="flex justify-end space-x-4">
          <button onclick="validateQuizJson()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">ê²€ì¦</button>
          <button onclick="previewQuiz()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">ë¯¸ë¦¬ë³´ê¸°</button>
          <button onclick="registerQuizGroup()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">ë“±ë¡í•˜ê¸°</button>
        </div>

        <div id="preview-area" class="hidden mt-8 p-6 bg-gray-50 rounded-lg">
          <h4 class="text-lg font-semibold mb-4">í€´ì¦ˆ ë¯¸ë¦¬ë³´ê¸°</h4>
          <div id="preview-content"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- í‘¸í„° -->
  <footer class="bg-white border-t mt-16 py-6">
    <div class="container mx-auto px-4 text-center">
      <div class="text-lg font-semibold text-gray-800">SBSì—°ì˜ˆë‰´ìŠ¤</div>
      <div class="text-sm text-gray-600">@yaongc</div>
      <div id="admin-button-container" class="mt-2">
        <!-- ìš”ì²­: ê¸°ì¡´ë³´ë‹¤ ì¡°ê¸ˆ ë” íë¦¬ê²Œ -->
        <button onclick="showAdminLogin()" class="text-gray-500 text-xs opacity-55 hover:opacity-90 font-semibold underline underline-offset-2 tracking-wide">admin</button>
      </div>
    </div>
  </footer>

  <script>
    /* ---------------- ê³µí†µ ìƒíƒœ ---------------- */
    let currentCategory = '';
    let currentNickname = '';
    let currentQuizIndex = 0;
    let totalParticipants = 1000;

    const scoringWeights = [17,17,17,17,16,16];
    let totalScore = 0;
    let correctCount = 0;

    const PARTICIPANTS_KEY = 'ent_participants_v1';
    function loadParticipants(){ try { return JSON.parse(localStorage.getItem(PARTICIPANTS_KEY)||'[]'); } catch { return []; } }
    function saveParticipant(rec){ const l=loadParticipants(); l.push(rec); localStorage.setItem(PARTICIPANTS_KEY, JSON.stringify(l)); }
    function getSeoulDateString(ts=Date.now()){ return new Date(ts).toLocaleDateString('sv-SE',{timeZone:'Asia/Seoul'}); }

    // ê´€ë¦¬ì ë¡œê·¸ì¸(í•´ì‹œ)
    const ADMIN_HASH = '2171ec0b29addbdd39bb33cda59477e88864561275ed1a33f357de2bfb013e13'; // sbsent|momo1234|ent-admin-v1
    function isAuthed(){ return sessionStorage.getItem('adminAuthed')==='1'; }
    function logoutAdmin(){ sessionStorage.removeItem('adminAuthed'); alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.'); goHome(); }
    async function loginAdmin(){
      const id=(document.getElementById('admin-login-id').value||'').trim();
      const pw=(document.getElementById('admin-login-pw').value||'').trim();
      if(!id||!pw){ alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      const txt=`${id}|${pw}|ent-admin-v1`;
      const enc=new TextEncoder().encode(txt);
      const buf=await crypto.subtle.digest('SHA-256', enc);
      const hashHex=Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
      if(hashHex===ADMIN_HASH){ sessionStorage.setItem('adminAuthed','1'); showAdminPage(); }
      else { alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
    }

    /* ---------------- ìƒ˜í”Œ í€´ì¦ˆ ë°ì´í„° ---------------- */
    const quizData = {
      'ì•„ì´ëŒ': [
        { id:1, question:'BTSì˜ ë¦¬ë”ëŠ” ëˆ„êµ¬ì¸ê°€ìš”?', options:['RM','ì§„','ìŠˆê°€','J-Hope'], correct:0, hint:'https://ent.sbs.co.kr', active:true, registrationDate:'2024-01-01T00:00:00.000Z' },
        { id:2, question:'ë¸”ë™í•‘í¬ì˜ ë©¤ë²„ê°€ ì•„ë‹Œ ì‚¬ëŒì€?', options:['ì§€ìˆ˜','ì œë‹ˆ','ë¡œì œ','ì•„ì´ë¦°'], correct:3, hint:'https://ent.sbs.co.kr', active:true, registrationDate:'2024-01-02T00:00:00.000Z' },
        { id:3, question:'NewJeansì˜ ë°ë·”ê³¡ì€?', options:['Attention','Hype Boy','Cookie','Hurt'], correct:0, hint:'https://ent.sbs.co.kr', active:true, registrationDate:'2024-01-03T00:00:00.000Z' },
        { id:4, question:'IVEì˜ ë¦¬ë”ëŠ” ëˆ„êµ¬ì¸ê°€ìš”?', options:['ì•ˆìœ ì§„','ê°€ì„','ë ˆì´','ë¦¬ì¦ˆ'], correct:0, hint:'https://ent.sbs.co.kr', active:true, registrationDate:'2024-01-04T00:00:00.000Z' },
        { id:5, question:'aespaì˜ ì†Œì†ì‚¬ëŠ”?', options:['JYP','SM','YG','HYBE'], correct:1, hint:'https://ent.sbs.co.kr', active:true, registrationDate:'2024-01-05T00:00:00.000Z' },
        { id:6, question:'(ì—¬ì)ì•„ì´ë“¤ì˜ ë¦¬ë”ëŠ”?', options:['ë¯¸ì—°','ë¯¼ë‹ˆ','ì†Œì—°','ìš°ê¸°'], correct:2, hint:'https://ent.sbs.co.kr', active:true, registrationDate:'2024-01-06T00:00:00.000Z' }
      ],
      'ë“œë¼ë§ˆ': [
        { question:'2023ë…„ ìµœê³  ì‹œì²­ë¥ ì„ ê¸°ë¡í•œ ë“œë¼ë§ˆëŠ”?', options:['ë” ê¸€ë¡œë¦¬','ì´ìƒí•œ ë³€í˜¸ì‚¬ ìš°ì˜ìš°','ì¬ë²Œì§‘ ë§‰ë‚´ì•„ë“¤','ìŠ¬ì˜ìƒ2'], correct:2, hint:'https://ent.sbs.co.kr' },
        { question:'ë°•ì„œì¤€ì´ ì£¼ì—°í•œ ë“œë¼ë§ˆê°€ ì•„ë‹Œ ê²ƒì€?', options:['ì´íƒœì› í´ë¼ì“°','ê¹€ë¹„ì„œê°€ ì™œ ê·¸ëŸ´ê¹Œ','ìŒˆ ë§ˆì´ì›¨ì´','ì‚¬ë‘ì˜ ë¶ˆì‹œì°©'], correct:3, hint:'https://ent.sbs.co.kr' },
        { question:'SKY ìºìŠ¬ì˜ ë°°ê²½ì´ ë˜ëŠ” ì§€ì—­ì€?', options:['ê°•ë‚¨êµ¬','ì„œì´ˆêµ¬','ì†¡íŒŒêµ¬','ê°•ì„œêµ¬'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ì˜¤ì§•ì–´ ê²Œì„ì˜ ì£¼ì¸ê³µ ì´ë¦„ì€?', options:['ê¸°í›ˆ','ìƒìš°','ë•ìˆ˜','ì¼ë‚¨'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ì‚¬ë‘ì˜ ë¶ˆì‹œì°©ì—ì„œ í˜„ë¹ˆì˜ ì§ì—…ì€?', options:['ì˜ì‚¬','êµ°ì¸','ì‚¬ì—…ê°€','ë³€í˜¸ì‚¬'], correct:1, hint:'https://ent.sbs.co.kr' },
        { question:'íœíŠ¸í•˜ìš°ìŠ¤ì˜ ë°°ê²½ì´ ë˜ëŠ” ì•„íŒŒíŠ¸ ì´ë¦„ì€?', options:['í—¤ë¼íŒ°ë¦¬ìŠ¤','ì˜¬ë¦¼í‘¸ìŠ¤','ì•„í…Œë‚˜','ì œìš°ìŠ¤'], correct:0, hint:'https://ent.sbs.co.kr' }
      ],
      'ì˜í™”': [
        { question:'ê¸°ìƒì¶©ì˜ ê°ë…ì€?', options:['ë´‰ì¤€í˜¸','ë°•ì°¬ìš±','ê¹€ì§€ìš´','ì´ì°½ë™'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'2023ë…„ í•œêµ­ ì˜í™” ê´€ê°ìˆ˜ 1ìœ„ëŠ”?', options:['ë²”ì£„ë„ì‹œ3','ìŠ¤ì¦ˆë©”ì˜ ë¬¸ë‹¨ì†','ê°€ë””ì–¸ì¦ˆ ì˜¤ë¸Œ ê°¤ëŸ­ì‹œ3','ë¶„ë…¸ì˜ ì§ˆì£¼10'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ë§ˆë™ì„ì´ ì¶œì—°í•˜ì§€ ì•Šì€ ì˜í™”ëŠ”?', options:['ë²”ì£„ë„ì‹œ','ë¶€ì‚°í–‰','ì•…ì¸ì „','íƒ€ì§œ3'], correct:3, hint:'https://ent.sbs.co.kr' },
        { question:'ì¹¸ ì˜í™”ì œ í™©ê¸ˆì¢…ë ¤ìƒì„ ë°›ì€ í•œêµ­ ì˜í™”ëŠ”?', options:['ì˜¬ë“œë³´ì´','ê¸°ìƒì¶©','ì•„ê°€ì”¨','ë²„ë‹'], correct:1, hint:'https://ent.sbs.co.kr' },
        { question:'ì†¡ê°•í˜¸ê°€ ì¶œì—°í•˜ì§€ ì•Šì€ ì˜í™”ëŠ”?', options:['ê¸°ìƒì¶©','ê´´ë¬¼','ì‚´ì¸ì˜ ì¶”ì–µ','ì‹ ê³¼í•¨ê»˜'], correct:3, hint:'https://ent.sbs.co.kr' },
        { question:'ë°•ì°¬ìš± ê°ë…ì˜ ì‘í’ˆì´ ì•„ë‹Œ ê²ƒì€?', options:['ì˜¬ë“œë³´ì´','ì•„ê°€ì”¨','í—¤ì–´ì§ˆ ê²°ì‹¬','ê³¡ì„±'], correct:3, hint:'https://ent.sbs.co.kr' }
      ],
      'ì˜ˆëŠ¥': [
        { question:'ëŸ°ë‹ë§¨ì˜ MCê°€ ì•„ë‹Œ ì‚¬ëŒì€?', options:['ìœ ì¬ì„','ê¹€ì¢…êµ­','ì†¡ì§€íš¨','ê°•í˜¸ë™'], correct:3, hint:'https://ent.sbs.co.kr' },
        { question:'ë¬´í•œë„ì „ì˜ ë§ˆì§€ë§‰ ë°©ì†¡ì€ ì–¸ì œ?', options:['2017ë…„','2018ë…„','2019ë…„','2020ë…„'], correct:1, hint:'https://ent.sbs.co.kr' },
        { question:'1ë°•2ì¼ì˜ í˜„ì¬ ì‹œì¦Œì€?', options:['ì‹œì¦Œ3','ì‹œì¦Œ4','ì‹œì¦Œ5','ì‹œì¦Œ6'], correct:1, hint:'https://ent.sbs.co.kr' },
        { question:'ë‚˜ í˜¼ì ì‚°ë‹¤ì˜ ë°©ì†¡ì‚¬ëŠ”?', options:['KBS','SBS','MBC','tvN'], correct:2, hint:'https://ent.sbs.co.kr' },
        { question:'ìœ í€´ì¦ˆ ì˜¨ ë” ë¸”ëŸ­ì˜ MCëŠ”?', options:['ìœ ì¬ì„, ì¡°ì„¸í˜¸','ìœ ì¬ì„, ì´ê´‘ìˆ˜','ìœ ì¬ì„, í•˜í•˜','ìœ ì¬ì„, ë°•ëª…ìˆ˜'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ê³¨ëª©ì‹ë‹¹ì˜ MCëŠ”?', options:['ë°±ì¢…ì›','ì´ì—°ë³µ','ìµœí˜„ì„','ê¹€í’'], correct:0, hint:'https://ent.sbs.co.kr' }
      ],
      'ìŠ¤íƒ€': [
        { question:'2023ë…„ ê°€ì¥ í™”ì œê°€ ëœ ì—°ì˜ˆì¸ ì»¤í”Œì€?', options:['í˜„ë¹ˆ-ì†ì˜ˆì§„','ì†¡ì¤‘ê¸°-ì†¡í˜œêµ','ì´ë¯¼í˜¸-ê¹€ê³ ì€','ë°•ì„œì¤€-ë°•ë¯¼ì˜'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ìµœê·¼ í•´ì™¸ ì§„ì¶œë¡œ ì£¼ëª©ë°›ëŠ” ë°°ìš°ëŠ”?', options:['ì´ì •ì¬','ë°•ì„œì¤€','ì†¡ê°•í˜¸','ê³µìœ '], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'2023ë…„ ê°€ì¥ ë§ì€ ê´‘ê³  ëª¨ë¸ì„ í•œ ì—°ì˜ˆì¸ì€?', options:['ì•„ì´ìœ ','ë°•ë³´ê²€','ì†¡í˜œêµ','ì „ì§€í˜„'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ìµœê·¼ SNS íŒ”ë¡œì›Œ ìˆ˜ê°€ ê¸‰ì¦í•œ ìŠ¤íƒ€ëŠ”?', options:['ì œë‹ˆ','ìˆ˜ì§€','íƒœì—°','ì•„ì´ë¦°'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'2023ë…„ ê°€ì¥ í™”ì œê°€ ëœ ì—°ì˜ˆì¸ ê²°í˜¼ì‹ì€?', options:['ì´ìŠ¹ê¸°-ì´ë‹¤ì¸','ì¡°ì •ì„-ê±°ë¯¸','ê¹€ìš°ë¹ˆ-ì‹ ë¯¼ì•„','ì´ì¢…ì„-í•œíš¨ì£¼'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ìµœê·¼ íŒ¨ì…˜ ì•„ì´ì½˜ìœ¼ë¡œ ì£¼ëª©ë°›ëŠ” ìŠ¤íƒ€ëŠ”?', options:['ì œë‹ˆ','í¬ë¦¬ìŠ¤íƒˆ','ìˆ˜ì§€','ì•„ì´ìœ '], correct:0, hint:'https://ent.sbs.co.kr' }
      ],
      'í•´ì™¸': [
        { question:'2023ë…„ ì•„ì¹´ë°ë¯¸ ì‘í’ˆìƒì„ ë°›ì€ ì˜í™”ëŠ”?', options:['ì—ë¸Œë¦¬ì”½ ì—ë¸Œë¦¬ì›¨ì–´ ì˜¬ ì•³ ì›ìŠ¤','íƒ‘ê±´: ë§¤ë²„ë¦­','ì•„ë°”íƒ€: ë¬¼ì˜ ê¸¸','ë°”ë¹Œë¡ '], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'í…Œì¼ëŸ¬ ìŠ¤ìœ„í”„íŠ¸ì˜ 2023ë…„ íˆ¬ì–´ ì´ë¦„ì€?', options:['Eras Tour','Reputation Tour','Lover Tour','Folklore Tour'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'2023ë…„ ê°€ì¥ í™”ì œê°€ ëœ í• ë¦¬ìš°ë“œ ì»¤í”Œì€?', options:['íŠ¸ë˜ë¹„ìŠ¤ ì¼ˆì‹œ-í…Œì¼ëŸ¬ ìŠ¤ìœ„í”„íŠ¸','í†° í™€ëœë“œ-ì  ë°ì´ì•„','í‹°ëª¨ì‹œ ìƒ¬ë¼ë©”-ì¹´ì¼ë¦¬ ì œë„ˆ','ë ˆì˜¤ë‚˜ë¥´ë„ ë””ì¹´í”„ë¦¬ì˜¤-ì§€ì§€ í•˜ë””ë“œ'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ë„·í”Œë¦­ìŠ¤ ì˜¤ë¦¬ì§€ë„ ì¤‘ 2023ë…„ ìµœê³  í™”ì œì‘ì€?', options:['ì›¬ì¦ˆë°ì´','ìŠ¤íŠ¸ë ˆì¸ì € ì”½ì¦ˆ4','ë¸Œë¦¬ì €íŠ¼3','ë” í¬ë¼ìš´6'], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'2023ë…„ ë¹Œë³´ë“œ ì˜¬í•´ì˜ ì•„í‹°ìŠ¤íŠ¸ëŠ”?', options:['í…Œì¼ëŸ¬ ìŠ¤ìœ„í”„íŠ¸','í•´ë¦¬ ìŠ¤íƒ€ì¼ìŠ¤','ë°°ë“œ ë²„ë‹ˆ','ì˜¬ë¦¬ë¹„ì•„ ë¡œë“œë¦¬ê³ '], correct:0, hint:'https://ent.sbs.co.kr' },
        { question:'ë§ˆë¸” ì‹œë„¤ë§ˆí‹± ìœ ë‹ˆë²„ìŠ¤ì˜ 2023ë…„ ì‘í’ˆì€?', options:['ê°€ë””ì–¸ì¦ˆ ì˜¤ë¸Œ ê°¤ëŸ­ì‹œ Vol.3','ì•¤íŠ¸ë§¨ê³¼ ì™€ìŠ¤í”„: í€€í…€ë§¤ë‹ˆì•„','ë” ë§ˆë¸”ìŠ¤','ëª¨ë“  ê²ƒ'], correct:3, hint:'https://ent.sbs.co.kr' }
      ]
    };

    /* ---------------- í™”ë©´ ì „í™˜ (async) ---------------- */
    async function showScreen(screenId){
      const screens=['home-screen','nickname-screen','quiz-screen','result-screen','admin-login-screen','admin-screen','admin-create-screen'];
      screens.forEach(id=>document.getElementById(id).classList.add('hidden'));
      document.getElementById(screenId).classList.remove('hidden');

      if(screenId==='home-screen'){
        document.getElementById('admin-button-container').style.display='block';
        renderTodayRanking('today-ranking');
      }

      if(screenId==='result-screen'){
        renderTodayRanking('overall-ranking-10', 10);

        // 1) ìºì‹œ ì¦‰ì‹œ ë Œë”
        const mem = loadCachedNews();
        if (mem && mem.length) {
          renderNewsList('news-container', mem);
        } else {
          newsSkeleton('news-container', 5);
        }

        // 2) í€´ì¦ˆ ì‹œì‘ ì‹œ í”„ë¦¬íŒ¨ì¹˜ëœ Promise ìµœëŒ€ 1200ms ëŒ€ê¸° í›„ ë°˜ì˜
        try {
          if (NEWS_PROMISE) {
            const items = await promiseWithTimeout(NEWS_PROMISE, 1200);
            if (Array.isArray(items) && items.length) renderNewsList('news-container', items);
          }
        } catch(e) {}

        // 3) ìµœì‹  ë°ì´í„°ë¡œ ì¡°ìš©íˆ ê°±ì‹ 
        ensureFreshRSS('news-container', 5);
      }
    }

    function selectCategory(category){ currentCategory=category; showScreen('nickname-screen'); }

    function startQuiz(){
      const nickname=document.getElementById('nickname-input').value.trim();
      if(!nickname){ alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
      currentNickname=nickname; currentQuizIndex=0; totalScore=0; correctCount=0;

      // ê²°ê³¼ í™”ë©´ ì¦‰ì‹œ ë…¸ì¶œ ìœ„í•œ ì‚¬ì „ í”„ë¦¬íŒ¨ì¹˜
      NEWS_PROMISE = warmRSSCache();

      showScreen('quiz-screen'); updateQuizHeader(); loadQuestion();
    }

    function goHome(){ showScreen('home-screen'); document.getElementById('nickname-input').value=''; }

    function showAdminLogin(){
      if(isAuthed()){ showAdminPage(); return; }
      showScreen('admin-login-screen'); document.getElementById('admin-button-container').style.display='none';
    }
    function showAdminPage(){
      if(!isAuthed()){ showAdminLogin(); return; }
      showScreen('admin-screen'); document.getElementById('admin-button-container').style.display='none'; renderCategoryTable();
    }

    /* ---------------- í€´ì¦ˆ ì§„í–‰ ---------------- */
    function updateQuizHeader(){ document.getElementById('quiz-header').textContent=`${currentCategory} í€´ì¦ˆ - ${currentNickname}ë‹˜`; }

    function loadQuestion(){
      const quiz=quizData[currentCategory][currentQuizIndex];
      document.getElementById('question-text').textContent=quiz.question;
      document.getElementById('progress-text').textContent=`${currentQuizIndex+1}/6`;
      document.getElementById('progress-bar').style.width=`${((currentQuizIndex+1)/6)*100}%`;

      const optionsContainer=document.getElementById('options-container'); optionsContainer.innerHTML='';
      quiz.options.forEach((opt,idx)=>{
        const btn=document.createElement('button');
        btn.className='w-full p-4 text-left bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border-2 border-transparent hover:border-purple-200';
        btn.textContent=`${idx+1}. ${opt}`;
        btn.onclick=()=>selectAnswer(idx);
        optionsContainer.appendChild(btn);
      });
    }

    function selectAnswer(sel){
      const quiz=quizData[currentCategory][currentQuizIndex];
      const isCorrect=sel===quiz.correct;
      if(isCorrect){ totalScore+=scoringWeights[currentQuizIndex]; correctCount+=1; showTooltip('ì •ë‹µ!','bg-green-500'); }
      else { showTooltip(`ì˜¤ë‹µ! ì •ë‹µ: ${quiz.options[quiz.correct]}`,'bg-red-500'); }

      const buttons=document.querySelectorAll('#options-container button');
      buttons.forEach((b,i)=>{ if(i===quiz.correct) b.classList.add('bg-green-200','border-green-400'); else if(i===sel&&!isCorrect) b.classList.add('bg-red-200','border-red-400'); b.disabled=true; });

      setTimeout(()=>{ currentQuizIndex++; if(currentQuizIndex<6) loadQuestion(); else showResult(); }, 1200);
    }

    function showTooltip(msg,bg){ const t=document.getElementById('answer-tooltip'); t.textContent=msg; t.className=`tooltip fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-6 py-3 rounded-lg text-white font-semibold text-lg z-50 ${bg}`; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'),700); }
    function showHint(){ const quiz=quizData[currentCategory][currentQuizIndex]; window.open(quiz.hint,'_blank'); }

    function showResult(){
      const roundedScore=Math.min(100, Math.max(0, Math.round(totalScore/5)*5));
      totalParticipants++; document.getElementById('total-participants').textContent=`${totalParticipants.toLocaleString()}ëª…`;
      saveParticipant({ nickname: currentNickname, category: currentCategory, totalScore: roundedScore, ts: Date.now() });

      showScreen('result-screen');
      document.getElementById('result-title').textContent=`${currentCategory} í€´ì¦ˆ í’€ê¸° ì™„ë£Œ!`;
      document.getElementById('result-score').textContent=`${currentNickname}ë‹˜ì˜ ì ìˆ˜: ${roundedScore}ì  (ì •ë‹µ ${correctCount}/6)`;

      let m=''; if(roundedScore===100) m='ì™„ë²½í•´ìš”! ë‹¹ì‹ ì€ ì§„ì •í•œ ì—°ì˜ˆê³„ ì „ë¬¸ê°€ë„¤ìš”! ğŸ†';
      else if(roundedScore>=70) m='í›Œë¥­í•´ìš”! ì—°ì˜ˆê³„ ì†Œì‹ì— ê´€ì‹¬ì´ ë§ìœ¼ì‹œë„¤ìš”! ğŸŒŸ';
      else if(roundedScore>=40) m='ê´œì°®ì•„ìš”! ì¡°ê¸ˆë§Œ ë” ê´€ì‹¬ì„ ê°€ì ¸ë³´ì„¸ìš”! ğŸ‘';
      else m='ì•„ì‰¬ì›Œìš”! ì—°ì˜ˆë‰´ìŠ¤ë¥¼ ë” ë§ì´ ë³´ì‹œëŠ” ê±¸ ì¶”ì²œí•´ìš”! ğŸ“º';
      document.getElementById('result-message').textContent=m;

      renderTodayRanking('overall-ranking-10', 10);
    }

    function retryQuiz(){ currentQuizIndex=0; totalScore=0; correctCount=0; showScreen('quiz-screen'); updateQuizHeader(); loadQuestion(); }
    function openNews(url){ window.open(url,'_blank'); }

    /* ---------------- ë­í‚¹ ---------------- */
    function renderTodayRanking(containerId, limit=5){
      const wrap=document.getElementById(containerId); if(!wrap) return;
      const list=loadParticipants(); const today=getSeoulDateString(); const banned=new Set(['ëª¨ëª¨','ã…‡ã„¹ã…‡']);
      const todays=list.filter(r=>getSeoulDateString(r.ts)===today).filter(r=>!banned.has(r.nickname));

      const best=new Map();
      todays.forEach(r=>{ const cur=best.get(r.nickname); if(!cur||r.totalScore>cur.totalScore||(r.totalScore===cur.totalScore&&r.ts<cur.ts)) best.set(r.nickname,r); });
      const top=Array.from(best.values()).sort((a,b)=>(b.totalScore-a.totalScore)||(a.ts-b.ts)).slice(0,limit);

      if(!top.length){ wrap.innerHTML=`<div class="text-center text-gray-500 py-6">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë­í‚¹ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”!</div>`; return; }

      wrap.innerHTML='';
      top.forEach((r,i)=>{
        const row=document.createElement('div'); row.className=`grid grid-cols-3 gap-4 py-2 ${i<top.length-1?'border-b':''}`;
        const medal=i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':(i+1); const medalClass=i===0?'medal-gold':i===1?'medal-silver':i===2?'medal-bronze':'text-gray-500';
        row.innerHTML=`
          <div class="text-center"><span class="${medalClass} ${i<3?'text-2xl':''}">${medal}</span></div>
          <div class="text-center"><span class="font-semibold">${r.nickname}</span></div>
          <div class="text-center"><span class="text-purple-600 font-semibold">${r.totalScore}ì  (${r.category})</span></div>
        `;
        wrap.appendChild(row);
      });
    }

    /* ---------------- ê´€ë¦¬ì ëª©ë¡ ---------------- */
    function getLastModifiedOfCategory(cat){
      const list=quizData[cat]||[]; if(!list.length) return null;
      const latest=list.reduce((acc,q)=>{ const t=new Date(q.registrationDate||0).getTime(); return t>acc?t:acc; },0);
      return latest?new Date(latest):null;
    }
    function formatDateK(d){ if(!d) return '-'; const yyyy=d.getFullYear(); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); const hh=String(d.getHours()).padStart(2,'0'); const mi=String(d.getMinutes()).padStart(2,'0'); return `${yyyy}.${mm}.${dd} ${hh}:${mi}`; }
    function renderCategoryTable(){
      const cats=['ì•„ì´ëŒ','ë“œë¼ë§ˆ','ì˜í™”','ì˜ˆëŠ¥','ìŠ¤íƒ€','í•´ì™¸']; const tbody=document.getElementById('category-table'); tbody.innerHTML='';
      cats.forEach(cat=>{
        (quizData[cat]||[]).forEach((q,i)=>{ if(!q.id) q.id=2000+i; if(!q.registrationDate) q.registrationDate=new Date(Date.now()-i*1000).toISOString(); });
        const cnt=(quizData[cat]||[]).length; const last=getLastModifiedOfCategory(cat);
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td class="border border-gray-300 px-4 py-3">${cat}</td>
          <td class="border border-gray-300 px-4 py-3 text-center">${cnt}ê°œ</td>
          <td class="border border-gray-300 px-4 py-3 text-center text-sm">${formatDateK(last)}</td>
          <td class="border border-gray-300 px-4 py-3 text-center">
            <button onclick="openCategoryUpdate('${cat}')" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm transition-colors">ìˆ˜ì •</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    /* ---------------- ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ ---------------- */
    let editingCategory=null;
    function openCategoryUpdate(cat){
      if(!isAuthed()){ showAdminLogin(); return; }
      editingCategory=cat; showScreen('admin-create-screen');
      document.getElementById('admin-create-title').textContent=`í€´ì¦ˆ ì—…ë°ì´íŠ¸ - ${cat}`;

      // âœ… ê¸°ì¡´ slice(0,2) ì œê±°: ì €ì¥ëœ ëª¨ë“  í€´ì¦ˆë¥¼ ë¡œë“œí•˜ê³ , í¸ì§‘ í™”ë©´ì—ì„œëŠ” ìµœëŒ€ 6ê°œê¹Œì§€ í‘œì‹œ
      const existingAll = (quizData[cat] || []).map(q => ({
        question: q.question,
        options: q.options,
        correctIndex: q.correct,
        hintUrl: q.hint || ''
      }));

      // ìµœëŒ€ 6ê°œê¹Œì§€ë§Œ ì‚¬ìš©(ìš”êµ¬ì‚¬í•­: 6ë¬¸ì œ ìš´ì˜)
      let cur = existingAll.slice(0, 6);

      // 6ê°œë³´ë‹¤ ì ìœ¼ë©´ ë”ë¯¸ë¡œ ì±„ì›Œì„œ í•­ìƒ 6ê°œ ë³´ì´ë„ë¡
      while (cur.length < 6) {
        cur.push({
          question: 'ìƒˆ ë¬¸ì œ',
          options: ['ë³´ê¸°1','ë³´ê¸°2','ë³´ê¸°3','ë³´ê¸°4'],
          correctIndex: 0,
          hintUrl: ''
        });
      }

      document.getElementById('admin-quiz-json').value = JSON.stringify({ quizzes: cur }, null, 2);
      document.getElementById('preview-area').classList.add('hidden');
      window.scrollTo({ top:0, behavior:'smooth' });
    }

    let lastCreateParsed=null;
    function validateCreateJsonText(text){
      try{
        const parsed=JSON.parse(text);
        if(!parsed.category && parsed['ì¹´í…Œê³ ë¦¬']) parsed.category=parsed['ì¹´í…Œê³ ë¦¬'];
        if(!parsed.category && !editingCategory) return {ok:false,msg:'category ë¬¸ìì—´ì´ ì—†ìœ¼ë©´, ëª©ë¡ì—ì„œ ì¹´í…Œê³ ë¦¬ë¥¼ ë¨¼ì € ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.'};
        if(!parsed.quizzes||!Array.isArray(parsed.quizzes)||!parsed.quizzes.length) return {ok:false,msg:'quizzes ë°°ì—´(1ê°œ ì´ìƒ)ì´ í•„ìš”í•©ë‹ˆë‹¤.'};
        for(let i=0;i<parsed.quizzes.length;i++){
          const q=parsed.quizzes[i];
          if(!q.question) return {ok:false,msg:`${i+1}ë²ˆì§¸ í€´ì¦ˆ: questionì´ í•„ìš”í•©ë‹ˆë‹¤.`};
          if(!Array.isArray(q.options)||q.options.length!==4) return {ok:false,msg:`${i+1}ë²ˆì§¸ í€´ì¦ˆ: optionsëŠ” 4ê°œì—¬ì•¼ í•©ë‹ˆë‹¤.`};
          if(typeof q.correctIndex!=='number'||q.correctIndex<0||q.correctIndex>3) return {ok:false,msg:`${i+1}ë²ˆì§¸ í€´ì¦ˆ: correctIndexëŠ” 0~3ì…ë‹ˆë‹¤.`};
        }
        return {ok:true,data:parsed};
      }catch(e){ return {ok:false,msg:`JSON í˜•ì‹ ì˜¤ë¥˜: ${e.message}`}; }
    }
    function showToast(m,ok=true){ const el=document.createElement('div'); el.className=`fixed top-6 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg shadow-md text-white z-50 ${ok?'bg-purple-600':'bg-red-500'}`; el.textContent=m; document.body.appendChild(el); setTimeout(()=>el.remove(),1500); }
    function showValidationTooltip(m,ok=true){ showToast(m,ok); }
    function validateQuizJson(){ const t=document.getElementById('admin-quiz-json').value; const r=validateCreateJsonText(t); if(r.ok) lastCreateParsed=r.data; else lastCreateParsed=null; showValidationTooltip(r.ok?'ê²€ì¦ í†µê³¼!':r.msg, !!r.ok); return r.ok; }
    function previewQuiz(){
      if(!validateQuizJson()) return;
      const p=lastCreateParsed; const area=document.getElementById('preview-area'); const content=document.getElementById('preview-content'); content.innerHTML='';
      p.quizzes.forEach((q,idx)=>{ const d=document.createElement('div'); d.className='mb-6 p-4 border border-gray-300 rounded-lg'; d.innerHTML=`
        <h5 class="font-semibold mb-3">ë¬¸ì œ ${idx+1}: ${q.question}</h5>
        <div class="space-y-2">${q.options.map((opt,i)=>`<div class="p-2 rounded ${i===q.correctIndex?'bg-green-100 border border-green-300':'bg-gray-50'}">${i+1}. ${opt} ${i===q.correctIndex?'(ì •ë‹µ)':''}</div>`).join('')}</div>
        ${q.hintUrl?`<div class="text-xs text-gray-500 mt-2">íŒíŠ¸: ${q.hintUrl}</div>`:''}
      `; content.appendChild(d); }); area.classList.remove('hidden'); window.scrollTo({ top: area.offsetTop-80, behavior:'smooth' }); }
    function showAdminList(){ showScreen('admin-screen'); renderCategoryTable(); window.scrollTo({ top:0, behavior:'smooth' }); }
    function registerQuizGroup(){
      if(!validateQuizJson()) return;
      const p=lastCreateParsed; const category=p.category||editingCategory; if(!category){ showToast('ì¹´í…Œê³ ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', false); return; }
      const regDate=new Date().toISOString();
      // ë“±ë¡ ì‹œ ì „ë‹¬ëœ quizzesë¥¼ ëª¨ë‘ ë°˜ì˜ (6ê°œë“  ê·¸ ì´ìƒì´ë“  ì €ì¥ ê°€ëŠ¥í•˜ì§€ë§Œ ìš´ì˜ì€ 6ê°œ ê¸°ì¤€)
      quizData[category]=p.quizzes.map((q,i)=>({ id:3000+i, question:q.question, options:q.options, correct:q.correctIndex, hint:q.hintUrl||'', active:true, registrationDate:regDate, meta:q.meta||{} }));
      lastCreateParsed=null; showAdminList(); showToast(`[${category}] ì¹´í…Œê³ ë¦¬ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    }

    /* ---------------- RSS í”„ë¦¬íŒ¨ì¹˜ â†’ ì¦‰ì‹œ ë Œë” ---------------- */
    const RSS_URL='https://ent.sbs.co.kr/news/xml/RSSFeed.do';
    const PROXY_ALLORIGINS_JSON='https://api.allorigins.win/get?url='+encodeURIComponent(RSS_URL); // JSON{ contents }
    const PROXY_ALLORIGINS_RAW='https://api.allorigins.win/raw?url='+encodeURIComponent(RSS_URL);  // ìˆœìˆ˜ í…ìŠ¤íŠ¸
    const PROXY_CODETABS='https://api.codetabs.com/v1/proxy?quest='+encodeURIComponent(RSS_URL);
    const PROXY_JINA='https://r.jina.ai/http://ent.sbs.co.kr/news/xml/RSSFeed.do';

    const NEWS_CACHE_KEY='ent_news_cache_v1';
    const NEWS_TTL_MS=3*60*1000;

    let NEWS_MEM=null;
    let NEWS_MEM_TS=0;
    let NEWS_PROMISE=null; // í”„ë¦¬íŒ¨ì¹˜ í”„ë¡œë¯¸ìŠ¤

    function getMemNews(){ return (NEWS_MEM && (Date.now()-NEWS_MEM_TS<NEWS_TTL_MS)) ? NEWS_MEM : null; }
    function setMemNews(items){ NEWS_MEM=items; NEWS_MEM_TS=Date.now(); }
    function loadCachedNews(){
      const mem=getMemNews(); if(mem) return mem;
      try{ const raw=sessionStorage.getItem(NEWS_CACHE_KEY); if(!raw) return null;
        const {ts,items}=JSON.parse(raw); if(Date.now()-ts<NEWS_TTL_MS && Array.isArray(items) && items.length){ setMemNews(items); return items; }
      }catch{} return null;
    }
    function saveCachedNews(items){ try{ sessionStorage.setItem(NEWS_CACHE_KEY, JSON.stringify({ts:Date.now(),items})); setMemNews(items); }catch{} }

    function newsSkeleton(containerId,count=5){
      const box=document.getElementById(containerId); if(!box) return; box.innerHTML='';
      for(let i=0;i<count;i++){ const card=document.createElement('div'); card.className='p-4 rounded-lg border border-gray-200 skeleton'; card.style.height='52px'; box.appendChild(card); }
    }
    function renderNewsList(containerId, items){
      const box=document.getElementById(containerId); if(!box) return; box.innerHTML='';
      const list=items.slice(0,5); while(list.length<5){ list.push({ title:'ì—°ì˜ˆê³„ ì†Œì‹ ì—…ë°ì´íŠ¸ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...', link:'https://ent.sbs.co.kr' }); }
      list.forEach(({title,link})=>{ const card=document.createElement('div'); card.className='p-4 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors border border-gray-200'; card.onclick=()=>openNews(link); card.innerHTML=`<div class="text-sm text-gray-800 font-medium leading-relaxed">${title}</div>`; box.appendChild(card); });
    }

    function parseMaybeJSONThenXML(text){
      // allorigins JSON í˜•íƒœë©´ contentsë¥¼ êº¼ë‚´ XML íŒŒì‹±
      try {
        const obj = JSON.parse(text);
        if (obj && typeof obj.contents === 'string') {
          return parseRSSItems(obj.contents, 5);
        }
      } catch(_) {
        // JSON ì•„ë‹ˆë©´ XMLë¡œ ì·¨ê¸‰
      }
      return parseRSSItems(text, 5);
    }

    function parseRSSItems(xmlText, max=5){
      try{
        const doc=new DOMParser().parseFromString(xmlText,'text/xml');
        const items = Array.from(doc.querySelectorAll('item')).slice(0,max).map(it=>({
          title: it.querySelector('title')?.textContent?.trim() || 'ì œëª© ì—†ìŒ',
          link: it.querySelector('link')?.textContent?.trim() || '#',
          pubDate: it.querySelector('pubDate')?.textContent?.trim() || ''
        }));
        return items;
      }catch{ return []; }
    }

    async function fetchText(url, ms=3000){
      const ctrl=new AbortController(); const timer=setTimeout(()=>ctrl.abort(), ms);
      try{
        const res=await fetch(url,{ signal: ctrl.signal, cache: 'no-store' });
        return await res.text();
      } finally { clearTimeout(timer); }
    }

    async function tryOne(fetcher){
      const text = await fetcher();
      const items = parseMaybeJSONThenXML(text);
      if (!items.length) throw new Error('No items');
      return items;
    }

    async function fetchRSSFast(){
      // ì‹ ë¢°ë„ ë†’ì€ allorigins JSON â†’ raw â†’ codetabs â†’ jina ìˆœ
      const candidates = [
        ()=>fetchText(PROXY_ALLORIGINS_JSON, 2800),
        ()=>fetchText(PROXY_ALLORIGINS_RAW, 2800),
        ()=>fetchText(PROXY_CODETABS, 2800),
        ()=>fetchText(PROXY_JINA, 2800),
      ];
      for (const fn of candidates) {
        try { return await tryOne(fn); } catch(e) { /* ë‹¤ìŒ í›„ë³´ë¡œ */ }
      }
      return [];
    }

    async function warmRSSCache(){
      // ìºì‹œê°€ ì‹ ì„ í•˜ë©´ ë„¤íŠ¸ì›Œí¬ íŒ¨ìŠ¤
      const cached = loadCachedNews();
      if (cached) return cached;
      const items = await fetchRSSFast();
      if (items.length) saveCachedNews(items);
      return items;
    }

    async function ensureFreshRSS(containerId='news-container', fixedCount=5){
      const fresh = await fetchRSSFast();
      if (fresh.length) {
        const prev = getMemNews() || [];
        const changed = JSON.stringify(prev.map(i=>i.title)) !== JSON.stringify(fresh.map(i=>i.title));
        saveCachedNews(fresh);
        if (changed) renderNewsList(containerId, fresh);
      } else {
        if (!getMemNews()) renderNewsList(containerId, []); // í´ë°±
      }
    }

    function promiseWithTimeout(p, ms){
      return new Promise((resolve, reject)=>{
        const t=setTimeout(()=>reject(new Error('timeout')), ms);
        p.then(v=>{ clearTimeout(t); resolve(v); }, e=>{ clearTimeout(t); reject(e); });
      });
    }

    /* ---------------- ì´ˆê¸°í™” ---------------- */
    document.getElementById('nickname-input').addEventListener('keypress',(e)=>{ if(e.key==='Enter') startQuiz(); });
    document.addEventListener('DOMContentLoaded', async ()=>{
      renderTodayRanking('today-ranking');
      // ì•± ê¸°ë™ ì‹œ 1íšŒ ì›Œë°ì—… (ê²°ê³¼ í™”ë©´ ì¦‰ì‹œì„± í–¥ìƒ)
      NEWS_PROMISE = warmRSSCache();
      // ì£¼ê¸° ê°±ì‹ (ë°±ê·¸ë¼ìš´ë“œ)
      setInterval(()=>ensureFreshRSS(), 120000);
    });
  </script>

  <!-- (Cloudflare script ìœ ì§€) -->
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96e71f0682b1aa47',t:'MTc1NTA3NjY2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>
