
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>오늘의 연예뉴스 퀴즈</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap');
    body { font-family: 'Noto Sans KR', sans-serif; }
    .tooltip { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; animation: fadeInOut 1.2s ease-in-out;}
    @keyframes fadeInOut { 0%{opacity:0;transform:translate(-50%,-50%) scale(.92)} 20%{opacity:1;transform:translate(-50%,-50%) scale(1)} 80%{opacity:1} 100%{opacity:0;transform:translate(-50%,-50%) scale(.98)}}
    .category-btn{transition:all .3s} .category-btn:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(0,0,0,.15)}
    .quiz-option{transition:all .2s} .quiz-option:hover{transform:translateX(5px)}
    .kb{word-break:keep-all}
    /* 관리자: 카드/테이블 경계 */
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .input{width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;background:#fff}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px}
    .badge.on{background:#dcfce7;color:#166534}.badge.off{background:#fee2e2;color:#991b1b}
    .table-wrap{overflow:auto}
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
  <!-- 공통 헤더 -->
  <header class="sticky top-0 z-20 bg-gradient-to-r from-indigo-600 to-fuchsia-500 text-white shadow">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="font-extrabold tracking-tight">🎬 오늘의 연예뉴스 퀴즈</div>
      <div class="flex items-center gap-2">
        <button id="btnGoAdmin" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-semibold">관리자</button>
        <button id="btnGoUser" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-semibold hidden">사용자</button>
      </div>
    </div>
  </header>

  <!-- ================= 사용자 영역 ================= -->
  <!-- 홈 화면 -->
  <div id="homeScreen" class="container mx-auto px-4 py-8">
    <div class="text-center mb-10">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-3">🎬 오늘의 연예뉴스 퀴즈 풀기! 🎭</h1>
      <p class="text-base sm:text-lg text-gray-600">뉴스 속 정답을 찾아라!</p>
    </div>

    <div class="max-w-2xl mx-auto grid grid-cols-1 sm:grid-cols-2 gap-6">
      <button onclick="startQuiz('방송')" class="category-btn bg-gradient-to-r from-blue-500 to-blue-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">📺</div><div class="text-xl font-semibold">방송</div>
      </button>
      <button onclick="startQuiz('영화')" class="category-btn bg-gradient-to-r from-red-500 to-red-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">🎬</div><div class="text-xl font-semibold">영화</div>
      </button>
      <button onclick="startQuiz('뮤직')" class="category-btn bg-gradient-to-r from-green-500 to-green-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">🎵</div><div class="text-xl font-semibold">뮤직</div>
      </button>
      <button onclick="startQuiz('스타')" class="category-btn bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">⭐</div><div class="text-xl font-semibold">스타</div>
      </button>
    </div>

    <!-- 참여자 수 카드 -->
    <div class="max-w-md mx-auto mt-8">
      <div class="bg-white rounded-2xl shadow p-5">
        <h3 class="text-lg font-bold text-gray-800 mb-1">📊 지금까지 참여한 사람</h3>
        <p class="text-gray-800 font-semibold">총 <span id="totalParticipants" class="text-purple-600 font-bold">0</span>명</p>
      </div>
    </div>

    <!-- 홈 랭킹 보드 (TOP 5) -->
    <div class="max-w-md mx-auto mt-4">
      <div class="bg-white rounded-2xl shadow p-5">
        <h3 class="text-lg font-bold text-gray-800 mb-3">🏆 오늘의 랭킹 TOP 5</h3>
        <div id="homeRankingBoard" class="space-y-2 text-gray-600">아직 랭킹 데이터가 없습니다.</div>
      </div>
    </div>

    <div class="text-center mt-12 text-gray-500 font-bold">SBS연예뉴스 - @yaongc</div>
  </div>

  <!-- 닉네임 입력 화면 -->
  <div id="nicknameScreen" class="container mx-auto px-4 py-8 hidden">
    <div class="max-w-md mx-auto">
      <div class="text-center mb-5">
        <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors mb-4">← 홈으로</button>
        <h2 id="selectedCategory" class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2"></h2>
        <p class="text-gray-600">닉네임을 입력해 주세요</p>
      </div>
      <div class="bg-white rounded-2xl shadow-xl p-6">
        <input id="nicknameInput" type="text" maxlength="10" placeholder="닉네임을 입력하세요"
               class="w-full p-4 border-2 border-gray-200 rounded-lg text-lg focus:border-purple-500 focus:outline-none mb-4">
        <button onclick="startQuizWithNickname()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-semibold">퀴즈 시작하기</button>
      </div>
    </div>
    <div class="text-center mt-12 text-gray-500 font-bold">SBS연예뉴스</div>
  </div>

  <!-- 퀴즈 화면 -->
  <div id="quizScreen" class="container mx-auto px-4 py-8 hidden">
    <div class="max-w-3xl mx-auto">
      <div class="flex justify-between items-center mb-6" id="quizHeaderRow">
        <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">← 홈으로</button>
        <div class="text-center">
          <h2 id="categoryTitle" class="text-xl sm:text-2xl font-bold text-gray-800"></h2>
          <p id="questionCounter" class="text-gray-600 mt-1" style="display:none;"></p>
        </div>
        <div class="w-16"></div>
      </div>

      <!-- 프로그레스 바 -->
      <div class="mb-6" id="quizProgressWrap">
        <div class="bg-gray-200 rounded-full h-3">
          <div id="progressBar" class="bg-purple-500 h-3 rounded-full transition-all duration-500" style="width:0%"></div>
        </div>
        <div class="text-center mt-1">
          <span id="progressText" class="text-sm text-gray-600"></span>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-xl p-6 mb-6" id="quizMainBox">
        <div class="flex justify-between items-start mb-4">
          <h3 id="questionText" class="text-lg sm:text-xl font-semibold text-gray-800 flex-1 mr-3 kb"></h3>
          <button id="hintBtn" onclick="showHint()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm whitespace-nowrap">💡 힌트보기</button>
        </div>
        <div id="optionsContainer" class="space-y-3"></div>
      </div>
    </div>
  </div>

  <!-- ================= 관리자 영역 ================= -->
  <div id="adminWrap" class="max-w-6xl mx-auto px-4 py-8 hidden">
    <!-- 로그인 -->
    <section id="loginScreen" class="card p-5">
      <h2 class="text-xl font-extrabold text-gray-800 mb-4">관리자 로그인</h2>
      <form id="loginForm" class="space-y-3">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-gray-500">아이디</label>
            <input id="loginId" autocomplete="username" class="input" />
          </div>
          <div>
            <label class="text-xs text-gray-500">비밀번호</label>
            <input id="loginPw" type="password" autocomplete="current-password" class="input" />
          </div>
        </div>
        <div>
          <button class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold" id="loginBtn" type="submit">로그인</button>
        </div>
      </form>
    </section>

    <!-- 목록 -->
    <section id="listScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">기사 목록</h2>
        <div class="flex items-center gap-3">
          <label class="text-sm text-gray-600"><input type="checkbox" id="filterActive" class="mr-1"> 사용 중만 보기</label>
          <button id="createQuizBtn" class="px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50">퀴즈 만들기</button>
          <button id="settingsBtn" class="px-3 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50">설정</button>
          <button id="logoutBtn" class="px-3 py-2 rounded-lg bg-gray-700 text-white">로그아웃</button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="text-left p-3">제목</th>
              <th class="text-left p-3">카테고리</th>
              <th class="text-left p-3">사용</th>
              <th class="text-left p-3">삭제</th>
            </tr>
          </thead>
          <tbody id="quizList"></tbody>
        </table>
      </div>
    </section>

    <!-- 설정 -->
    <section id="settingsScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">설정</h2>
        <button id="backToListBtnSettings" class="px-3 py-2 rounded-lg bg-gray-600 text-white">뒤로가기</button>
      </div>

      <div class="space-y-3">
        <label class="text-sm font-semibold text-gray-700">ChatGPT API Key</label>
        <input id="gptApiKeyInput" type="password" placeholder="sk-..." class="input" />
        <div class="text-xs text-gray-500">* 이 키는 브라우저 localStorage에만 저장됩니다. 운영환경은 백엔드 프록시 권장.</div>
        <button id="saveGptKeyBtn" class="mt-2 px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">저장</button>
      </div>
    </section>

    <!-- 생성 -->
    <section id="createScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">퀴즈 만들기</h2>
        <button id="backToListBtn1" class="px-3 py-2 rounded-lg bg-gray-600 text-white">뒤로가기</button>
      </div>

      <!-- 사용 여부 토글: 라벨과 밀착 -->
      <div class="bg-slate-50 border border-gray-200 rounded-xl p-3 mb-3">
        <div class="flex items-center gap-3">
          <div class="text-sm font-semibold">사용 여부</div>
          <label class="inline-flex items-center cursor-pointer">
            <input type="checkbox" id="createUse" class="sr-only peer" checked>
            <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-green-500 transition"></div>
            <div class="w-5 h-5 bg-white rounded-full -ml-9 translate-x-0 peer-checked:translate-x-5 transition shadow"></div>
          </label>
        </div>
        <div class="text-xs text-gray-500 mt-1">목록/서비스 노출</div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div>
          <label class="text-xs text-gray-500">카테고리</label>
          <select id="createCategory" class="input">
            <option>방송</option><option>영화</option><option>뮤직</option><option>스타</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="text-xs text-gray-500">제목</label>
          <input id="createTitle" class="input" />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
        <div>
          <label class="text-xs text-gray-500">URL</label>
          <input id="createUrl" class="input" placeholder="https://..." />
        </div>
        <div>
          <label class="text-xs text-gray-500">본문 (최대 3000자)</label>
          <textarea id="createContent" class="input" maxlength="3000" rows="6"></textarea>
        </div>
      </div>

      <div class="flex items-center justify-between mt-3">
        <p class="text-sm text-gray-500">본문에서 객관식/주관식(OX 포함) 2개 생성</p>
        <button id="createGenerate" class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">퀴즈 2개 생성</button>
      </div>

      <h3 class="mt-4 font-bold">생성된 퀴즈 (선택 후 등록/재생성)</h3>
      <div id="createPreview" class="mt-2 space-y-2"></div>
      <div id="createActions" class="flex items-center justify-end gap-2 mt-3 hidden">
        <button id="createRegister" class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">등록하기</button>
        <button id="createRegen" class="px-4 py-2 rounded-lg bg-gray-100 border">다시 생성</button>
      </div>
    </section>

    <!-- 편집 (생성 화면과 동일 UI) -->
    <section id="editScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">기사 편집</h2>
        <button id="backToListBtn2" class="px-3 py-2 rounded-lg bg-gray-600 text-white">뒤로가기</button>
      </div>

      <!-- 사용 여부 토글: 라벨 옆 밀착 + 상단 배치 -->
      <div class="bg-slate-50 border border-gray-200 rounded-xl p-3 mb-3">
        <div class="flex items-center gap-3">
          <div class="text-sm font-semibold">사용 여부</div>
          <label class="inline-flex items-center cursor-pointer">
            <input type="checkbox" id="editUse" class="sr-only peer">
            <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-green-500 transition"></div>
            <div class="w-5 h-5 bg-white rounded-full -ml-9 translate-x-0 peer-checked:translate-x-5 transition shadow"></div>
          </label>
        </div>
        <div class="text-xs text-gray-500 mt-1">목록/서비스 노출</div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div>
          <label class="text-xs text-gray-500">카테고리</label>
          <select id="editCategory" class="input">
            <option>방송</option><option>영화</option><option>뮤직</option><option>스타</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="text-xs text-gray-500">제목</label>
          <input id="editTitle" class="input" />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
        <div>
          <label class="text-xs text-gray-500">URL</label>
          <input id="editUrl" class="input" />
        </div>
        <div>
          <label class="text-xs text-gray-500">본문</label>
          <textarea id="editContent" class="input" maxlength="3000" rows="6"></textarea>
        </div>
      </div>

      <h3 class="mt-4 font-bold">현재 적용된 퀴즈</h3>
      <div id="appliedList" class="mt-2 space-y-2"></div>

      <div class="flex items-center justify-between mt-3">
        <button id="editRegenSelected" class="px-4 py-2 rounded-lg bg-gray-100 border">선택 퀴즈 다시 생성</button>
        <button id="saveArticleBtn" class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">저장</button>
      </div>
    </section>
  </div>

  <script>
    /* ===================== 공통/상태 ===================== */
    const VALID_ID='sbsent', VALID_PW='momo1234';
    const STORAGE_KEY = 'qa_articles';

    // (사용자 제공) 인기뉴스 TOP10 원제목/원링크 그대로. 지금은 5개지만 10개로 계속 확장 가능.
    const popularArticlesTop10 = [
      { title: '홍진경, 결혼 22년 만에 이혼…"남이 된 후 진짜 우정 되찾아"', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304723' },
      { title: '애즈원 이민, 자택서 사망 확인...크리스탈 급거 귀국', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304730' },
      { title: "'사마귀' 고현정, 사형수 됐다…남자 5명 죽인 잔혹한 연쇄살인마 파격 변신", url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304767' },
      { title: '이수근, 가슴저린 부친상..."유년기 단둘이 지낸 애틋한 아버지"', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304696' },
      { title: '홍진경, 이혼 뒤늦게 밝힌 이유..."좋은 부모가 되기 위한 노력"', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304760' },
      // 필요 시 여기 뒤에 5개 더 추가하면 자동으로 랜덤 5개 노출됨
    ];

    const $ = (id)=>document.getElementById(id);
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    function readArticles(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }catch{ return []; }
    }
    function writeArticles(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

    /* ===================== 사용자 로직 ===================== */
    // 기존 더미 퀴즈(보충용)
    const quizData = { 
      '방송': [
        { question: "SBS '궁금한 이야기Y'에서 다룬 한강 괴물 목격담에서, 목격자가 본 생명체의 길이는 얼마나 되었을까요?", options: ["5미터", "10미터", "15미터", "20미터"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304831" },
        { question: "'궁금한 이야기Y'는 언제 방송되나요?", options: ["목요일 밤 8시 50분", "금요일 밤 8시 50분", "토요일 밤 8시 50분", "일요일 밤 8시 50분"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304831" },
        { question: "SBS '트라이'에서 다루는 스포츠는 무엇인가요?", options: ["축구", "농구", "럭비", "야구"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304783" },
        { question: "SBS '트라이'의 주인공들이 도전하는 목표는 무엇인가요?", options: ["전국체전 우승", "올림픽 출전", "프로리그 진출", "세계선수권 출전"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304783" },
        { question: "이경규의 새 예능 '마이 턴'의 소재는 무엇인가요?", options: ["요리 경연", "트롯돌 프로젝트", "여행 버라이어티", "게임 쇼"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304788" },
        { question: "'마이 턴'에 출연하는 출연자는 몇 명인가요?", options: ["5명", "6명", "7명", "8명"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304788" }
      ],
      '영화': [
        { question: "'극장판 귀멸의 칼날: 무한성편'의 개봉 2주 전 예매량은 얼마나 되었을까요?", options: ["20만 장", "23만 장", "25만 장", "30만 장"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304850" },
        { question: "'극장판 귀멸의 칼날: 무한성편'은 언제 개봉하나요?", options: ["8월 15일", "8월 20일", "8월 22일", "8월 25일"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304850" },
        { question: "iPhone 16 Pro로 촬영된 단편 영화 '백! 스테이지'의 러닝타임은?", options: ["18분", "20분", "22분", "25분"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304852" },
        { question: "'백! 스테이지'의 주연 배우는 누구인가요?", options: ["ATEEZ 윤호", "ATEEZ 홍중", "ATEEZ 성화", "ATEEZ 우영"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304852" },
        { question: "영화 '좀비딸'이 개봉 6일 만에 돌파한 관객 수는?", options: ["150만", "200만", "250만", "300만"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304846" },
        { question: "'좀비딸'에서 신스틸러 역할을 하는 고양이의 이름은?", options: ["애용이", "사랑이", "귀염이", "예쁨이"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304846" }
      ],
      '뮤직': [
        { question: "선미의 이번 컴백은 이전 싱글 'Balloon in Love' 발표 후 얼마 만인가요?", options: ["6개월 만", "1년 만", "1년 2개월 만", "1년 6개월 만"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304833" },
        { question: "선미의 신곡은 언제 공개되나요?", options: ["8월 24일 오후 6시", "8월 25일 오후 6시", "8월 26일 오후 6시", "8월 27일 오후 6시"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304833" },
        { question: "아이유의 팬밋업 'Bye, Summer'가 개최되는 장소는?", options: ["올림픽공원", "KSPO DOME", "잠실실내체육관", "고척스카이돔"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304843" },
        { question: "아이유 팬밋업은 몇 년 만의 오프라인 공식 팬행사인가요?", options: ["1년 만", "2년 만", "3년 만", "4년 만"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304843" },
        { question: "빅히트 뮤직의 신인 보이그룹 '코르티스(CORTIS)'는 몇 인조 그룹인가요?", options: ["4인조", "5인조", "6인조", "7인조"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304759" },
        { question: "'코르티스(CORTIS)'의 데뷔 예정일은 언제인가요?", options: ["8월 15일", "8월 18일", "8월 20일", "8월 25일"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304759" }
      ],
      '스타': [
        { question: "박진주가 출연하는 드라마 '내 딸 친구의 엄마'에서 박진주가 맡은 역할의 이름은?", options: ["김희진", "서희진", "박희진", "이희진"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304724" },
        { question: "'O'PENing 2025'는 언제 첫 방송되나요?", options: ["8월 15일", "8월 16일", "8월 17일", "8월 18일"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304724" },
        { question: "차인표가 수상한 문학상은 무엇인가요?", options: ["이상문학상", "황순원문학상", "김유정문학상", "현대문학상"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304680" },
        { question: "차인표의 수상작 소설 제목은 무엇인가요?", options: ["바다사냥", "인어사냥", "물고기사냥", "고래사냥"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304680" },
        { question: "차주영이 서경덕 교수와 제작한 광복 80주년 기념 영상의 제목은?", options: ["빛을 담은 항일유산", "역사를 담은 항일유산", "희망을 담은 항일유산", "정신을 담은 항일유산"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304669" },
        { question: "차주영의 광복 80주년 기념 영상의 러닝타임은?", options: ["3분 30초", "4분", "4분 30초", "5분"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304669" }
      ]
    };

    let currentCategory = '';
    let currentQuestionIndex = 0;
    let currentQuestions = [];
    let answered = false;
    let userNickname = '';
    let correctAnswers = 0;

    let rankings = JSON.parse(localStorage.getItem('quizRankings') || '[]');
    if (!Array.isArray(rankings) || rankings.length === 0) {
      rankings = [
        { nickname: "민수", category: "방송", score: 95 },
        { nickname: "지영", category: "영화", score: 90 },
        { nickname: "철수", category: "뮤직", score: 88 },
        { nickname: "영희", category: "스타", score: 85 },
        { nickname: "하준", category: "방송", score: 82 },
        { nickname: "수빈", category: "영화", score: 80 }
      ];
      localStorage.setItem('quizRankings', JSON.stringify(rankings));
    }
    let totalParticipants = Number(localStorage.getItem('totalParticipants') || '150');
    localStorage.setItem('totalParticipants', String(totalParticipants));

    function updateHomeBoards() {
      $('totalParticipants').textContent = String(totalParticipants);
      const board = $('homeRankingBoard');
      if (!rankings.length) {
        board.textContent = '아직 랭킹 데이터가 없습니다.';
      } else {
        board.innerHTML = rankings.slice(0, 5).map((r, i) => {
          const medal = i === 0 ? '🥇' : i === 1 ? '🥈' : i === 2 ? '🥉' : (i + 1) + '위';
          return `<div class="flex items-center justify-between gap-2 py-2 px-3 rounded-lg bg-gray-50">
            <span class="font-semibold">${medal}</span>
            <span class="flex-1 text-center">${r.nickname}</span>
            <span class="text-sm text-gray-500">${r.score}점</span>
          </div>`;
        }).join('');
      }
    }

    // 관리자가 만든 퀴즈(활성) 우선 사용
    function getAdminQuizzesByCategory(category){
      const arts = readArticles().filter(a => a.active && a.category===category && Array.isArray(a.quizzes) && a.quizzes.length);
      const qs = [];
      arts.forEach(a=>{
        a.quizzes.forEach(q=>{
          if(q.type==='MCQ' && Array.isArray(q.options) && q.options.length>=4){
            qs.push({question:q.question, options:q.options.slice(0,4), correct:Number(q.correct)||0, hint:a.url||''});
          }else if(q.type==='OX'){
            const correct = (String(q.answer||'O').toUpperCase()==='X')?1:0;
            qs.push({question:q.question, options:['O','X'], correct, hint:a.url||''});
          } // SHORT는 사용자 화면에선 건너뜀
        });
      });
      return qs;
    }

    function startQuiz(category) {
      currentCategory = category;
      $('selectedCategory').textContent = `${category} 퀴즈`;
      hide($('homeScreen')); show($('nicknameScreen'));
      $('nicknameInput').value = ''; $('nicknameInput').focus();
    }

    function pickRandom(list, n) {
      const a = list.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a.slice(0, n);
    }

    function startQuizWithNickname() {
      const nickname = $('nicknameInput').value.trim();
      if (!nickname) { alert('닉네임을 입력해주세요!'); return; }
      userNickname = nickname;

      const adminQs = getAdminQuizzesByCategory(currentCategory);
      const need = 6;
      let list = adminQs.slice(0, need);
      if (list.length < need) {
        const fallback = quizData[currentCategory] || [];
        const remain = need - list.length;
        list = list.concat(pickRandom(fallback, remain));
      } else {
        list = pickRandom(list, need);
      }

      currentQuestions = list;
      currentQuestionIndex = 0;
      correctAnswers = 0;

      hide($('nicknameScreen')); show($('quizScreen'));
      $('categoryTitle').textContent = `${currentCategory} 퀴즈 - ${userNickname}님`;

      showQuestion();
    }

    document.addEventListener('DOMContentLoaded', function() {
      updateHomeBoards();
      // 상단 카운터 텍스트는 사용하지 않음
      const qc = $('questionCounter'); if (qc) qc.style.display = 'none';
      $('nicknameInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') startQuizWithNickname();
      });
    });

    function showQuestion() {
      const q = currentQuestions[currentQuestionIndex];
      answered = false;

      const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
      $('progressBar').style.width = `${progress}%`;
      $('progressText').textContent = `${currentQuestionIndex + 1} / ${currentQuestions.length}`;

      $('questionText').textContent = q.question;

      const optionsContainer = $('optionsContainer');
      optionsContainer.innerHTML = '';

      q.options.forEach((opt, idx) => {
        const div = document.createElement('div');
        div.className = 'quiz-option bg-gray-50 hover:bg-gray-100 p-4 rounded-lg cursor-pointer border-2 border-transparent transition-all';
        div.textContent = `${idx + 1}. ${opt}`;
        div.onclick = () => selectAnswer(idx, div);
        optionsContainer.appendChild(div);
      });

      // 진행 중에는 헤더/프로그레스 보이기
      show(document.getElementById('quizHeaderRow'));
      show(document.getElementById('quizProgressWrap'));
    }

    function selectAnswer(selectedIndex, el) {
      if (answered) return;
      answered = true;

      const q = currentQuestions[currentQuestionIndex];
      const ok = selectedIndex === q.correct;
      if (ok) correctAnswers++;

      const options = document.querySelectorAll('.quiz-option');
      options.forEach(o => o.style.pointerEvents = 'none');

      options[q.correct].classList.add('border-green-500', 'bg-green-100');
      if (!ok) el.classList.add('border-red-500', 'bg-red-100');

      showTooltip(ok ? '정답!' : '오답!', ok);
      setTimeout(nextQuestion, 1200);
    }

    function showTooltip(msg, ok) {
      const t = document.createElement('div');
      t.className = `tooltip px-6 py-3 rounded-2xl text-white text-xl font-bold ${ok ? 'bg-green-500' : 'bg-red-500'}`;
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => document.body.removeChild(t), 1100);
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < currentQuestions.length) showQuestion();
      else showCompletionView();
    }

    function scoreMessage(score) {
      if (score >= 90) return "완벽해요! 오늘 뉴스 마스터 🔥";
      if (score >= 70) return "아주 좋아요! 한 끗만 더 ✨";
      if (score >= 50) return "괜찮아요! 조금만 더 파고들면 됩니다 💪";
      if (score >= 30) return "시동 걸렸어요! 다음엔 더 잘할 수 있어요 🚀";
      return "괜찮아요! 기사 힌트도 적극 활용해보자 😊";
    }

    // 하단 박스 빌더: 랭킹 / 인기뉴스 (각각 박스)
    function buildRankingBox(rankingHTML) {
      return `
        <div class="bg-white rounded-2xl shadow p-5">
          <h4 class="text-lg font-bold text-gray-800 mb-3">🏆 오늘의 랭킹 TOP 10</h4>
          <div class="space-y-2">
            ${rankingHTML}
          </div>
        </div>
      `;
    }
    function buildPopularBox() {
      const howMany = 5;
      const selected = pickRandom(popularArticlesTop10, Math.min(howMany, popularArticlesTop10.length));
      while (selected.length < howMany) selected.push({ title: '콘텐츠 준비 중', url: '#', placeholder: true });

      const items = selected.map((item) => `
        <a href="${item.url}" target="_blank" rel="noopener" 
           class="block rounded-2xl border border-gray-200 bg-white px-4 py-3 hover:shadow transition kb">
          ${item.title}
        </a>
      `).join('');

      return `
        <div class="bg-white rounded-2xl shadow p-5">
          <h4 class="text-lg font-bold text-gray-800 mb-3">🔥 오늘의 인기뉴스 TOP 5</h4>
          <div class="grid gap-2">
            ${items}
          </div>
        </div>
      `;
    }

    function showCompletionView() {
      const score = Math.round((correctAnswers / currentQuestions.length) * 100);

      totalParticipants += 1;
      localStorage.setItem('totalParticipants', String(totalParticipants));
      rankings.push({ nickname: userNickname, category: currentCategory, score });
      rankings.sort((a, b) => b.score - a.score);
      rankings = rankings.slice(0, 50);
      localStorage.setItem('quizRankings', JSON.stringify(rankings));

      const rankingHTML = rankings.slice(0, 10).map((r, i) => {
        const medal = i === 0 ? '🥇' : i === 1 ? '🥈' : i === 2 ? '🥉' : (i + 1) + '위';
        const me = r.nickname === userNickname ? 'bg-yellow-100' : '';
        return `<div class="flex items-center justify-between gap-2 py-2 px-3 rounded-lg bg-gray-50 ${me}">
          <span class="font-semibold">${medal}</span>
          <span class="flex-1 text-center">${r.nickname}</span>
          <span class="text-sm text-gray-500">${r.score}점 (${r.category})</span>
        </div>`;
      }).join('');

      // 결과 화면: 상단 헤더/프로그레스바 감춤, 좌상단 단독 홈버튼 없음
      hide(document.getElementById('quizHeaderRow'));
      hide(document.getElementById('quizProgressWrap'));

      const box = $('optionsContainer');
      box.innerHTML = `
        <div class="space-y-6">
          <!-- 내 결과 박스 -->
          <div class="bg-white rounded-2xl border border-gray-200 shadow p-6 text-center">
            <div class="text-5xl mb-3">🎉</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-1">${currentCategory} 퀴즈 완료!</h3>
            <p class="text-purple-600 font-bold mb-3">${userNickname}님의 점수: ${score}점 (${correctAnswers}/${currentQuestions.length})</p>
            <p class="text-gray-600 mb-4 kb">${scoreMessage(score)}</p>
            <div class="flex items-center justify-center gap-2 flex-wrap">
              <button onclick="retryQuiz()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">다시 풀기</button>
              <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">홈으로 가기</button>
            </div>
          </div>

          <!-- 하단: 좌우 5:5 -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              ${buildRankingBox(rankingHTML)}
            </div>
            <div>
              ${buildPopularBox()}
            </div>
          </div>
        </div>
      `;

      // 문제 본문/힌트 버튼 감춤
      $('questionText').textContent = '';
      $('hintBtn').style.display = 'none';

      updateHomeBoards();
    }

    function retryQuiz() {
      // 헤더/프로그레스 복원
      show(document.getElementById('quizHeaderRow'));
      show(document.getElementById('quizProgressWrap'));

      const adminQs = getAdminQuizzesByCategory(currentCategory);
      const need = 6;
      let list = adminQs.slice(0, need);
      if (list.length < need) {
        const fallback = quizData[currentCategory] || [];
        const remain = need - list.length;
        list = list.concat(pickRandom(fallback, remain));
      } else {
        list = pickRandom(list, need);
      }
      currentQuestions = list;
      currentQuestionIndex = 0;
      correctAnswers = 0;
      $('hintBtn').style.display = 'inline-flex';
      showQuestion();
    }

    function showHint() {
      const q = currentQuestions[currentQuestionIndex];
      if (q && q.hint) window.open(q.hint, '_blank');
    }

    function goHome() {
      hide($('quizScreen')); hide($('nicknameScreen')); show($('homeScreen'));
      $('hintBtn').style.display = 'inline-flex';
      show(document.getElementById('quizHeaderRow'));
      show(document.getElementById('quizProgressWrap'));
      updateHomeBoards();
    }

    // 관리자/사용자 전환 버튼
    $('btnGoAdmin').addEventListener('click', ()=>{
      hide($('homeScreen')); hide($('nicknameScreen')); hide($('quizScreen'));
      show($('adminWrap'));
      hide($('btnGoAdmin')); show($('btnGoUser'));
      if(localStorage.getItem('logged_demo')==='1'){ showList(); } else { showLogin(); }
    });
    $('btnGoUser').addEventListener('click', ()=>{
      show($('homeScreen'));
      hide($('adminWrap'));
      show($('btnGoAdmin')); hide($('btnGoUser'));
    });

    /* ===================== 관리자 로직 ===================== */
    let editingIndex = null;
    let createPreviewQuizzes = [];

    function showLogin(){
      show($('loginScreen')); hide($('listScreen')); hide($('createScreen')); hide($('editScreen')); hide($('settingsScreen'));
      $('logoutBtn').classList.add('hidden');
    }
    function showList(){
      hide($('loginScreen')); show($('listScreen')); hide($('createScreen')); hide($('editScreen')); hide($('settingsScreen'));
      $('logoutBtn').classList.remove('hidden');
      renderList();
    }
    function showCreate(){
      hide($('loginScreen')); hide($('listScreen')); show($('createScreen')); hide($('editScreen')); hide($('settingsScreen'));
    }
    function showEdit(){
      hide($('loginScreen')); hide($('listScreen')); hide($('createScreen')); show($('editScreen')); hide($('settingsScreen'));
    }

    // 로그인
    $('loginForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const id=$('loginId').value.trim(), pw=$('loginPw').value.trim();
      if(id===VALID_ID && pw===VALID_PW){ localStorage.setItem('logged_demo','1'); showList(); }
      else alert('아이디 또는 비밀번호가 잘못되었습니다.');
    });
    $('logoutBtn').addEventListener('click', ()=>{ localStorage.removeItem('logged_demo'); showLogin(); });

    // 설정 화면
    $('settingsBtn').addEventListener('click', ()=>{
      hide($('loginScreen')); hide($('listScreen')); hide($('createScreen')); hide($('editScreen'));
      show($('settingsScreen'));
      $('gptApiKeyInput').value = localStorage.getItem('gpt_api_key') || '';
    });
    $('backToListBtnSettings').addEventListener('click', showList);
    $('saveGptKeyBtn').addEventListener('click', ()=>{
      const v = $('gptApiKeyInput').value.trim();
      if(!v){ alert('API Key를 입력하세요.'); return; }
      localStorage.setItem('gpt_api_key', v);
      alert('저장되었습니다.');
    });

    // 목록 렌더
    function renderList(){
      const onlyActive = $('filterActive').checked;
      const tb = $('quizList'); tb.innerHTML='';
      const list = readArticles();
      list.forEach((a,i)=>{
        if(onlyActive && !a.active) return;
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td class="p-3 align-top">
            <a href="#" data-i="${i}" class="text-indigo-600 hover:underline font-semibold">${a.title||'(제목 없음)'}</a>
            <div class="text-xs text-gray-500">${a.url||''}</div>
          </td>
          <td class="p-3 align-top">${a.category||''}</td>
          <td class="p-3 align-top">${a.active?'<span class="badge on">사용</span>':'<span class="badge off">미사용</span>'}</td>
          <td class="p-3 align-top"><button class="px-3 py-1 rounded bg-red-500 text-white text-xs" data-del="${i}">삭제</button></td>
        `;
        tb.appendChild(tr);
      });
      tb.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const idx=+btn.getAttribute('data-del');
          if(confirm('정말 삭제하시겠습니까?')){
            const arr = readArticles(); arr.splice(idx,1); writeArticles(arr); renderList();
          }
        });
      });
      tb.querySelectorAll('a[data-i]').forEach(a=>{
        a.addEventListener('click',(e)=>{
          e.preventDefault();
          openEdit(+a.getAttribute('data-i'));
        });
      });
    }
    $('filterActive').addEventListener('change', renderList);

    // 생성 화면 진입/나가기
    $('createQuizBtn').addEventListener('click', ()=>{
      $('createUse').checked = true;
      $('createCategory').value = '방송';
      $('createTitle').value=''; $('createUrl').value=''; $('createContent').value='';
      createPreviewQuizzes = []; $('createPreview').innerHTML=''; $('createActions').classList.add('hidden');
      showCreate();
    });
    $('backToListBtn1').addEventListener('click', showList);
    $('backToListBtn2').addEventListener('click', showList);

    // 더미 퀴즈 생성기 (키 없이 테스트용)
    function dummyQuizzes(category, content, count){
      const pool = [
        {type:'MCQ', question:`${category} 기사 핵심은 무엇인가요?`, options:['새 발표','수상','투어 일정','논란'], correct:0, explanation:'본문 요약'},
        {type:'OX', question:`본문에 일정이 언급되었나요?`, answer:'O', explanation:'첫 문단'},
        {type:'MCQ', question:`향후 계획으로 맞는 것은?`, options:['파트2 공개','활동 중단','해외 이주','휴식'], correct:0, explanation:'후반부'}
      ];
      const out=[]; while(out.length<count){ out.push(JSON.parse(JSON.stringify(pool[Math.floor(Math.random()*pool.length)]))); }
      return out;
    }

    function renderQuizCards(containerId, quizzes, withCheckbox){
      const host=$(containerId); host.innerHTML='';
      quizzes.forEach((q,i)=>{
        const card=document.createElement('div');
        card.className='border border-gray-200 rounded-xl p-3';
        let head = (withCheckbox?`<input type="checkbox" data-i="${i}" class="mr-2">`:'') + `<b>Q${i+1}.</b> ${q.question||'(질문 없음)'}`;
        card.innerHTML = `<div class="mb-2">${head}</div>`;
        if(q.type==='MCQ'){
          const labs=['A','B','C','D']; const opts=(q.options||[]).slice(0,4);
          card.innerHTML += opts.map((o,idx)=>`
            <div class="flex items-center gap-2 text-sm border rounded-lg px-2 py-1 mb-1 ${idx===(q.correct||0)?'border-green-300 bg-green-50':''}">
              <span class="inline-flex w-6 h-6 items-center justify-center rounded-full bg-indigo-50 font-bold">${labs[idx]}</span>
              <span>${o||''}</span>
            </div>`).join('');
        }else if(q.type==='OX'){
          const ans = (String(q.answer||'O').toUpperCase()==='X')?'X':'O';
          ['O','X'].forEach(v=>{
            card.innerHTML += `
              <div class="inline-flex items-center gap-2 text-sm border rounded-lg px-3 py-1 mr-2 ${ans===v?'border-green-300 bg-green-50':''}">
                <span class="inline-flex w-6 h-6 items-center justify-center rounded-full bg-indigo-50 font-bold">${v}</span>
              </div>`;
          });
        }else{ // SHORT → 표시만
          card.innerHTML += `<div class="text-sm text-slate-700"><b>정답(단답)</b>: ${q.answer||''}</div>`;
        }
        if(q.explanation){ card.innerHTML += `<div class="text-xs text-slate-500 mt-1">해설: ${q.explanation}</div>`; }
        host.appendChild(card);
      });
    }
    function getCheckedIndices(containerId){
      return Array.from(document.querySelectorAll('#'+containerId+' input[type=checkbox]')).filter(x=>x.checked).map(x=>+x.getAttribute('data-i'));
    }

    // 생성 화면: 퀴즈 생성 (GPT 시도 → 실패 시 더미 폴백)
    $('createGenerate').addEventListener('click', async ()=>{
      const content = $('createContent').value.trim();
      if(!content){ alert('본문을 입력하세요'); return; }

      const category = $('createCategory').value;
      const key = localStorage.getItem('gpt_api_key');

      async function generateViaGPT(cat, body){
        if(!key) return null;
        try{
          const sys = "You are a quiz generator for Korean entertainment news. Output STRICT JSON with {\"quizzes\":[...]} containing exactly 2 items. Each item: either {\"type\":\"MCQ\",\"question\":\"...\",\"options\":[\"A\",\"B\",\"C\",\"D\"],\"correct\":0-3,\"explanation\":\"...\"} or {\"type\":\"OX\",\"question\":\"...\",\"answer\":\"O\"|\"X\",\"explanation\":\"...\"}. No extra text.";
          const usr = `카테고리: ${cat}\n다음 기사 본문을 바탕으로 퀴즈 2개를 생성해줘.\n본문:\n${body}`;

          const res = await fetch("https://api.openai.com/v1/chat/completions",{
            method:"POST",
            headers:{
              "Content-Type":"application/json",
              "Authorization":`Bearer ${key}`
            },
            body: JSON.stringify({
              model: "gpt-4o-mini",
              messages: [
                {role:"system", content: sys},
                {role:"user", content: usr}
              ],
              temperature: 0.4,
              response_format: { type: "json_object" }
            })
          });

          if(!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          const text = data.choices?.[0]?.message?.content || "";
          const parsed = JSON.parse(text);
          const out = parsed.quizzes || null;
          if(!Array.isArray(out) || out.length < 2) return null;
          return out;
        }catch(e){
          console.warn("GPT 호출 실패:", e);
          return null;
        }
      }

      let qs = await generateViaGPT(category, content);
      if(!qs){
        qs = dummyQuizzes(category, content, 2);
      }

      createPreviewQuizzes = qs;
      renderQuizCards('createPreview', createPreviewQuizzes, true);
      $('createActions').classList.remove('hidden');
    });

    // 생성 화면: 등록
    $('createRegister').addEventListener('click', ()=>{
      const selected = getCheckedIndices('createPreview');
      if(!selected.length){ alert('등록할 퀴즈를 선택하세요'); return; }
      const a = {
        title: $('createTitle').value || $('createContent').value.slice(0,30),
        category: $('createCategory').value,
        active: $('createUse').checked,
        url: $('createUrl').value,
        content: $('createContent').value,
        quizzes: selected.map(i=>createPreviewQuizzes[i])
      };
      const arr = readArticles(); arr.push(a); writeArticles(arr);
      showList();
    });

    // 생성 화면: 선택 재생성
    $('createRegen').addEventListener('click', ()=>{
      const selected = getCheckedIndices('createPreview');
      if(!selected.length){ alert('다시 생성할 퀴즈를 선택하세요'); return; }
      const content = $('createContent').value.trim();
      const fresh = dummyQuizzes($('createCategory').value, content, selected.length);
      selected.forEach((idx,k)=>{ createPreviewQuizzes[idx] = fresh[k]; });
      renderQuizCards('createPreview', createPreviewQuizzes, true);
    });

    // 편집
    function openEdit(index){
      editingIndex = index;
      const a = readArticles()[index];
      $('editCategory').value = a.category||'방송';
      $('editTitle').value = a.title||'';
      $('editUrl').value = a.url||'';
      $('editContent').value = a.content||'';
      $('editUse').checked = !!a.active;
      renderQuizCards('appliedList', a.quizzes||[], true);
      showEdit();
    }

    $('editRegenSelected').addEventListener('click', ()=>{
      const arr = readArticles();
      const a = arr[editingIndex];
      const selected = getCheckedIndices('appliedList');
      if(!selected.length){ alert('다시 생성할 퀴즈를 선택하세요'); return; }
      const fresh = dummyQuizzes(a.category, a.content, selected.length);
      selected.forEach((idx,k)=>{ a.quizzes[idx] = fresh[k]; });
      writeArticles(arr);
      renderQuizCards('appliedList', a.quizzes, true);
    });

    $('saveArticleBtn').addEventListener('click', ()=>{
      const arr = readArticles();
      const a = arr[editingIndex];
      a.category = $('editCategory').value;
      a.title = $('editTitle').value;
      a.url = $('editUrl').value;
      a.content = $('editContent').value;
      a.active = $('editUse').checked;
      writeArticles(arr);
      alert('저장되었습니다.');
      showList();
    });

  </script>
</body>
</html>
