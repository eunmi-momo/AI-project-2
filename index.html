
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ ì—°ì˜ˆë‰´ìŠ¤ í€´ì¦ˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap');
    body { font-family: 'Noto Sans KR', sans-serif; }
    .tooltip { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; animation: fadeInOut 1.2s ease-in-out;}
    @keyframes fadeInOut { 0%{opacity:0;transform:translate(-50%,-50%) scale(.92)} 20%{opacity:1;transform:translate(-50%,-50%) scale(1)} 80%{opacity:1} 100%{opacity:0;transform:translate(-50%,-50%) scale(.98)}}
    .category-btn{transition:all .3s} .category-btn:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(0,0,0,.15)}
    .quiz-option{transition:all .2s} .quiz-option:hover{transform:translateX(5px)}
    .kb{word-break:keep-all}
    /* ê´€ë¦¬ì: ì¹´ë“œ/í…Œì´ë¸” ê²½ê³„ */
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .input{width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;background:#fff}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px}
    .badge.on{background:#dcfce7;color:#166534}.badge.off{background:#fee2e2;color:#991b1b}
    .table-wrap{overflow:auto}
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
  <!-- ê³µí†µ í—¤ë” -->
  <header class="sticky top-0 z-20 bg-gradient-to-r from-indigo-600 to-fuchsia-500 text-white shadow">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="font-extrabold tracking-tight">ğŸ¬ ì˜¤ëŠ˜ì˜ ì—°ì˜ˆë‰´ìŠ¤ í€´ì¦ˆ</div>
      <div class="flex items-center gap-2">
        <button id="btnGoAdmin" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-semibold">ê´€ë¦¬ì</button>
        <button id="btnGoUser" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-semibold hidden">ì‚¬ìš©ì</button>
      </div>
    </div>
  </header>

  <!-- ================= ì‚¬ìš©ì ì˜ì—­ ================= -->
  <!-- í™ˆ í™”ë©´ -->
  <div id="homeScreen" class="container mx-auto px-4 py-8">
    <div class="text-center mb-10">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-3">ğŸ¬ ì˜¤ëŠ˜ì˜ ì—°ì˜ˆë‰´ìŠ¤ í€´ì¦ˆ í’€ê¸°! ğŸ­</h1>
      <p class="text-base sm:text-lg text-gray-600">ë‰´ìŠ¤ ì† ì •ë‹µì„ ì°¾ì•„ë¼!</p>
    </div>

    <div class="max-w-2xl mx-auto grid grid-cols-1 sm:grid-cols-2 gap-6">
      <button onclick="startQuiz('ë°©ì†¡')" class="category-btn bg-gradient-to-r from-blue-500 to-blue-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">ğŸ“º</div><div class="text-xl font-semibold">ë°©ì†¡</div>
      </button>
      <button onclick="startQuiz('ì˜í™”')" class="category-btn bg-gradient-to-r from-red-500 to-red-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">ğŸ¬</div><div class="text-xl font-semibold">ì˜í™”</div>
      </button>
      <button onclick="startQuiz('ë®¤ì§')" class="category-btn bg-gradient-to-r from-green-500 to-green-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">ğŸµ</div><div class="text-xl font-semibold">ë®¤ì§</div>
      </button>
      <button onclick="startQuiz('ìŠ¤íƒ€')" class="category-btn bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-8 rounded-2xl shadow-lg hover:shadow-xl">
        <div class="text-4xl mb-3">â­</div><div class="text-xl font-semibold">ìŠ¤íƒ€</div>
      </button>
    </div>

    <!-- ì°¸ì—¬ì ìˆ˜ ì¹´ë“œ -->
    <div class="max-w-md mx-auto mt-8">
      <div class="bg-white rounded-2xl shadow p-5">
        <h3 class="text-lg font-bold text-gray-800 mb-1">ğŸ“Š ì§€ê¸ˆê¹Œì§€ ì°¸ì—¬í•œ ì‚¬ëŒ</h3>
        <p class="text-gray-800 font-semibold">ì´ <span id="totalParticipants" class="text-purple-600 font-bold">0</span>ëª…</p>
      </div>
    </div>

    <!-- í™ˆ ë­í‚¹ ë³´ë“œ (TOP 5) -->
    <div class="max-w-md mx-auto mt-4">
      <div class="bg-white rounded-2xl shadow p-5">
        <h3 class="text-lg font-bold text-gray-800 mb-3">ğŸ† ì˜¤ëŠ˜ì˜ ë­í‚¹ TOP 5</h3>
        <div id="homeRankingBoard" class="space-y-2 text-gray-600">ì•„ì§ ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="text-center mt-12 text-gray-500 font-bold">SBSì—°ì˜ˆë‰´ìŠ¤ - @yaongc</div>
  </div>

  <!-- ë‹‰ë„¤ì„ ì…ë ¥ í™”ë©´ -->
  <div id="nicknameScreen" class="container mx-auto px-4 py-8 hidden">
    <div class="max-w-md mx-auto">
      <div class="text-center mb-5">
        <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors mb-4">â† í™ˆìœ¼ë¡œ</button>
        <h2 id="selectedCategory" class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2"></h2>
        <p class="text-gray-600">ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”</p>
      </div>
      <div class="bg-white rounded-2xl shadow-xl p-6">
        <input id="nicknameInput" type="text" maxlength="10" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
               class="w-full p-4 border-2 border-gray-200 rounded-lg text-lg focus:border-purple-500 focus:outline-none mb-4">
        <button onclick="startQuizWithNickname()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-semibold">í€´ì¦ˆ ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
    <div class="text-center mt-12 text-gray-500 font-bold">SBSì—°ì˜ˆë‰´ìŠ¤</div>
  </div>

  <!-- í€´ì¦ˆ í™”ë©´ -->
  <div id="quizScreen" class="container mx-auto px-4 py-8 hidden">
    <div class="max-w-3xl mx-auto">
      <div class="flex justify-between items-center mb-6" id="quizHeaderRow">
        <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">â† í™ˆìœ¼ë¡œ</button>
        <div class="text-center">
          <h2 id="categoryTitle" class="text-xl sm:text-2xl font-bold text-gray-800"></h2>
          <p id="questionCounter" class="text-gray-600 mt-1" style="display:none;"></p>
        </div>
        <div class="w-16"></div>
      </div>

      <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
      <div class="mb-6" id="quizProgressWrap">
        <div class="bg-gray-200 rounded-full h-3">
          <div id="progressBar" class="bg-purple-500 h-3 rounded-full transition-all duration-500" style="width:0%"></div>
        </div>
        <div class="text-center mt-1">
          <span id="progressText" class="text-sm text-gray-600"></span>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-xl p-6 mb-6" id="quizMainBox">
        <div class="flex justify-between items-start mb-4">
          <h3 id="questionText" class="text-lg sm:text-xl font-semibold text-gray-800 flex-1 mr-3 kb"></h3>
          <button id="hintBtn" onclick="showHint()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm whitespace-nowrap">ğŸ’¡ íŒíŠ¸ë³´ê¸°</button>
        </div>
        <div id="optionsContainer" class="space-y-3"></div>
      </div>
    </div>
  </div>

  <!-- ================= ê´€ë¦¬ì ì˜ì—­ ================= -->
  <div id="adminWrap" class="max-w-6xl mx-auto px-4 py-8 hidden">
    <!-- ë¡œê·¸ì¸ -->
    <section id="loginScreen" class="card p-5">
      <h2 class="text-xl font-extrabold text-gray-800 mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
      <form id="loginForm" class="space-y-3">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-gray-500">ì•„ì´ë””</label>
            <input id="loginId" autocomplete="username" class="input" />
          </div>
          <div>
            <label class="text-xs text-gray-500">ë¹„ë°€ë²ˆí˜¸</label>
            <input id="loginPw" type="password" autocomplete="current-password" class="input" />
          </div>
        </div>
        <div>
          <button class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold" id="loginBtn" type="submit">ë¡œê·¸ì¸</button>
        </div>
      </form>
    </section>

    <!-- ëª©ë¡ -->
    <section id="listScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">ê¸°ì‚¬ ëª©ë¡</h2>
        <div class="flex items-center gap-3">
          <label class="text-sm text-gray-600"><input type="checkbox" id="filterActive" class="mr-1"> ì‚¬ìš© ì¤‘ë§Œ ë³´ê¸°</label>
          <button id="createQuizBtn" class="px-4 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50">í€´ì¦ˆ ë§Œë“¤ê¸°</button>
          <button id="settingsBtn" class="px-3 py-2 rounded-lg bg-white border border-gray-300 hover:bg-gray-50">ì„¤ì •</button>
          <button id="logoutBtn" class="px-3 py-2 rounded-lg bg-gray-700 text-white">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="text-left p-3">ì œëª©</th>
              <th class="text-left p-3">ì¹´í…Œê³ ë¦¬</th>
              <th class="text-left p-3">ì‚¬ìš©</th>
              <th class="text-left p-3">ì‚­ì œ</th>
            </tr>
          </thead>
          <tbody id="quizList"></tbody>
        </table>
      </div>
    </section>

    <!-- ì„¤ì • -->
    <section id="settingsScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">ì„¤ì •</h2>
        <button id="backToListBtnSettings" class="px-3 py-2 rounded-lg bg-gray-600 text-white">ë’¤ë¡œê°€ê¸°</button>
      </div>

      <div class="space-y-3">
        <label class="text-sm font-semibold text-gray-700">ChatGPT API Key</label>
        <input id="gptApiKeyInput" type="password" placeholder="sk-..." class="input" />
        <div class="text-xs text-gray-500">* ì´ í‚¤ëŠ” ë¸Œë¼ìš°ì € localStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ìš´ì˜í™˜ê²½ì€ ë°±ì—”ë“œ í”„ë¡ì‹œ ê¶Œì¥.</div>
        <button id="saveGptKeyBtn" class="mt-2 px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">ì €ì¥</button>
      </div>
    </section>

    <!-- ìƒì„± -->
    <section id="createScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">í€´ì¦ˆ ë§Œë“¤ê¸°</h2>
        <button id="backToListBtn1" class="px-3 py-2 rounded-lg bg-gray-600 text-white">ë’¤ë¡œê°€ê¸°</button>
      </div>

      <!-- ì‚¬ìš© ì—¬ë¶€ í† ê¸€: ë¼ë²¨ê³¼ ë°€ì°© -->
      <div class="bg-slate-50 border border-gray-200 rounded-xl p-3 mb-3">
        <div class="flex items-center gap-3">
          <div class="text-sm font-semibold">ì‚¬ìš© ì—¬ë¶€</div>
          <label class="inline-flex items-center cursor-pointer">
            <input type="checkbox" id="createUse" class="sr-only peer" checked>
            <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-green-500 transition"></div>
            <div class="w-5 h-5 bg-white rounded-full -ml-9 translate-x-0 peer-checked:translate-x-5 transition shadow"></div>
          </label>
        </div>
        <div class="text-xs text-gray-500 mt-1">ëª©ë¡/ì„œë¹„ìŠ¤ ë…¸ì¶œ</div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div>
          <label class="text-xs text-gray-500">ì¹´í…Œê³ ë¦¬</label>
          <select id="createCategory" class="input">
            <option>ë°©ì†¡</option><option>ì˜í™”</option><option>ë®¤ì§</option><option>ìŠ¤íƒ€</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="text-xs text-gray-500">ì œëª©</label>
          <input id="createTitle" class="input" />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
        <div>
          <label class="text-xs text-gray-500">URL</label>
          <input id="createUrl" class="input" placeholder="https://..." />
        </div>
        <div>
          <label class="text-xs text-gray-500">ë³¸ë¬¸ (ìµœëŒ€ 3000ì)</label>
          <textarea id="createContent" class="input" maxlength="3000" rows="6"></textarea>
        </div>
      </div>

      <div class="flex items-center justify-between mt-3">
        <p class="text-sm text-gray-500">ë³¸ë¬¸ì—ì„œ ê°ê´€ì‹/ì£¼ê´€ì‹(OX í¬í•¨) 2ê°œ ìƒì„±</p>
        <button id="createGenerate" class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">í€´ì¦ˆ 2ê°œ ìƒì„±</button>
      </div>

      <h3 class="mt-4 font-bold">ìƒì„±ëœ í€´ì¦ˆ (ì„ íƒ í›„ ë“±ë¡/ì¬ìƒì„±)</h3>
      <div id="createPreview" class="mt-2 space-y-2"></div>
      <div id="createActions" class="flex items-center justify-end gap-2 mt-3 hidden">
        <button id="createRegister" class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">ë“±ë¡í•˜ê¸°</button>
        <button id="createRegen" class="px-4 py-2 rounded-lg bg-gray-100 border">ë‹¤ì‹œ ìƒì„±</button>
      </div>
    </section>

    <!-- í¸ì§‘ (ìƒì„± í™”ë©´ê³¼ ë™ì¼ UI) -->
    <section id="editScreen" class="card p-5 hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-800">ê¸°ì‚¬ í¸ì§‘</h2>
        <button id="backToListBtn2" class="px-3 py-2 rounded-lg bg-gray-600 text-white">ë’¤ë¡œê°€ê¸°</button>
      </div>

      <!-- ì‚¬ìš© ì—¬ë¶€ í† ê¸€: ë¼ë²¨ ì˜† ë°€ì°© + ìƒë‹¨ ë°°ì¹˜ -->
      <div class="bg-slate-50 border border-gray-200 rounded-xl p-3 mb-3">
        <div class="flex items-center gap-3">
          <div class="text-sm font-semibold">ì‚¬ìš© ì—¬ë¶€</div>
          <label class="inline-flex items-center cursor-pointer">
            <input type="checkbox" id="editUse" class="sr-only peer">
            <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-green-500 transition"></div>
            <div class="w-5 h-5 bg-white rounded-full -ml-9 translate-x-0 peer-checked:translate-x-5 transition shadow"></div>
          </label>
        </div>
        <div class="text-xs text-gray-500 mt-1">ëª©ë¡/ì„œë¹„ìŠ¤ ë…¸ì¶œ</div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div>
          <label class="text-xs text-gray-500">ì¹´í…Œê³ ë¦¬</label>
          <select id="editCategory" class="input">
            <option>ë°©ì†¡</option><option>ì˜í™”</option><option>ë®¤ì§</option><option>ìŠ¤íƒ€</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="text-xs text-gray-500">ì œëª©</label>
          <input id="editTitle" class="input" />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
        <div>
          <label class="text-xs text-gray-500">URL</label>
          <input id="editUrl" class="input" />
        </div>
        <div>
          <label class="text-xs text-gray-500">ë³¸ë¬¸</label>
          <textarea id="editContent" class="input" maxlength="3000" rows="6"></textarea>
        </div>
      </div>

      <h3 class="mt-4 font-bold">í˜„ì¬ ì ìš©ëœ í€´ì¦ˆ</h3>
      <div id="appliedList" class="mt-2 space-y-2"></div>

      <div class="flex items-center justify-between mt-3">
        <button id="editRegenSelected" class="px-4 py-2 rounded-lg bg-gray-100 border">ì„ íƒ í€´ì¦ˆ ë‹¤ì‹œ ìƒì„±</button>
        <button id="saveArticleBtn" class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold">ì €ì¥</button>
      </div>
    </section>
  </div>

  <script>
    /* ===================== ê³µí†µ/ìƒíƒœ ===================== */
    const VALID_ID='sbsent', VALID_PW='momo1234';
    const STORAGE_KEY = 'qa_articles';

    // (ì‚¬ìš©ì ì œê³µ) ì¸ê¸°ë‰´ìŠ¤ TOP10 ì›ì œëª©/ì›ë§í¬ ê·¸ëŒ€ë¡œ. ì§€ê¸ˆì€ 5ê°œì§€ë§Œ 10ê°œë¡œ ê³„ì† í™•ì¥ ê°€ëŠ¥.
    const popularArticlesTop10 = [
      { title: 'í™ì§„ê²½, ê²°í˜¼ 22ë…„ ë§Œì— ì´í˜¼â€¦"ë‚¨ì´ ëœ í›„ ì§„ì§œ ìš°ì • ë˜ì°¾ì•„"', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304723' },
      { title: 'ì• ì¦ˆì› ì´ë¯¼, ìíƒì„œ ì‚¬ë§ í™•ì¸...í¬ë¦¬ìŠ¤íƒˆ ê¸‰ê±° ê·€êµ­', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304730' },
      { title: "'ì‚¬ë§ˆê·€' ê³ í˜„ì •, ì‚¬í˜•ìˆ˜ ëë‹¤â€¦ë‚¨ì 5ëª… ì£½ì¸ ì”í˜¹í•œ ì—°ì‡„ì‚´ì¸ë§ˆ íŒŒê²© ë³€ì‹ ", url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304767' },
      { title: 'ì´ìˆ˜ê·¼, ê°€ìŠ´ì €ë¦° ë¶€ì¹œìƒ..."ìœ ë…„ê¸° ë‹¨ë‘˜ì´ ì§€ë‚¸ ì• í‹‹í•œ ì•„ë²„ì§€"', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304696' },
      { title: 'í™ì§„ê²½, ì´í˜¼ ë’¤ëŠ¦ê²Œ ë°íŒ ì´ìœ ..."ì¢‹ì€ ë¶€ëª¨ê°€ ë˜ê¸° ìœ„í•œ ë…¸ë ¥"', url: 'https://ent.sbs.co.kr/m/article.do?article_id=E10010304760' },
      // í•„ìš” ì‹œ ì—¬ê¸° ë’¤ì— 5ê°œ ë” ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ëœë¤ 5ê°œ ë…¸ì¶œë¨
    ];

    const $ = (id)=>document.getElementById(id);
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    function readArticles(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }catch{ return []; }
    }
    function writeArticles(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

    /* ===================== ì‚¬ìš©ì ë¡œì§ ===================== */
    // ê¸°ì¡´ ë”ë¯¸ í€´ì¦ˆ(ë³´ì¶©ìš©)
    const quizData = { 
      'ë°©ì†¡': [
        { question: "SBS 'ê¶ê¸ˆí•œ ì´ì•¼ê¸°Y'ì—ì„œ ë‹¤ë£¬ í•œê°• ê´´ë¬¼ ëª©ê²©ë‹´ì—ì„œ, ëª©ê²©ìê°€ ë³¸ ìƒëª…ì²´ì˜ ê¸¸ì´ëŠ” ì–¼ë§ˆë‚˜ ë˜ì—ˆì„ê¹Œìš”?", options: ["5ë¯¸í„°", "10ë¯¸í„°", "15ë¯¸í„°", "20ë¯¸í„°"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304831" },
        { question: "'ê¶ê¸ˆí•œ ì´ì•¼ê¸°Y'ëŠ” ì–¸ì œ ë°©ì†¡ë˜ë‚˜ìš”?", options: ["ëª©ìš”ì¼ ë°¤ 8ì‹œ 50ë¶„", "ê¸ˆìš”ì¼ ë°¤ 8ì‹œ 50ë¶„", "í† ìš”ì¼ ë°¤ 8ì‹œ 50ë¶„", "ì¼ìš”ì¼ ë°¤ 8ì‹œ 50ë¶„"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304831" },
        { question: "SBS 'íŠ¸ë¼ì´'ì—ì„œ ë‹¤ë£¨ëŠ” ìŠ¤í¬ì¸ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", options: ["ì¶•êµ¬", "ë†êµ¬", "ëŸ­ë¹„", "ì•¼êµ¬"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304783" },
        { question: "SBS 'íŠ¸ë¼ì´'ì˜ ì£¼ì¸ê³µë“¤ì´ ë„ì „í•˜ëŠ” ëª©í‘œëŠ” ë¬´ì—‡ì¸ê°€ìš”?", options: ["ì „êµ­ì²´ì „ ìš°ìŠ¹", "ì˜¬ë¦¼í”½ ì¶œì „", "í”„ë¡œë¦¬ê·¸ ì§„ì¶œ", "ì„¸ê³„ì„ ìˆ˜ê¶Œ ì¶œì „"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304783" },
        { question: "ì´ê²½ê·œì˜ ìƒˆ ì˜ˆëŠ¥ 'ë§ˆì´ í„´'ì˜ ì†Œì¬ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", options: ["ìš”ë¦¬ ê²½ì—°", "íŠ¸ë¡¯ëŒ í”„ë¡œì íŠ¸", "ì—¬í–‰ ë²„ë¼ì´ì–´í‹°", "ê²Œì„ ì‡¼"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304788" },
        { question: "'ë§ˆì´ í„´'ì— ì¶œì—°í•˜ëŠ” ì¶œì—°ìëŠ” ëª‡ ëª…ì¸ê°€ìš”?", options: ["5ëª…", "6ëª…", "7ëª…", "8ëª…"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304788" }
      ],
      'ì˜í™”': [
        { question: "'ê·¹ì¥íŒ ê·€ë©¸ì˜ ì¹¼ë‚ : ë¬´í•œì„±í¸'ì˜ ê°œë´‰ 2ì£¼ ì „ ì˜ˆë§¤ëŸ‰ì€ ì–¼ë§ˆë‚˜ ë˜ì—ˆì„ê¹Œìš”?", options: ["20ë§Œ ì¥", "23ë§Œ ì¥", "25ë§Œ ì¥", "30ë§Œ ì¥"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304850" },
        { question: "'ê·¹ì¥íŒ ê·€ë©¸ì˜ ì¹¼ë‚ : ë¬´í•œì„±í¸'ì€ ì–¸ì œ ê°œë´‰í•˜ë‚˜ìš”?", options: ["8ì›” 15ì¼", "8ì›” 20ì¼", "8ì›” 22ì¼", "8ì›” 25ì¼"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304850" },
        { question: "iPhone 16 Proë¡œ ì´¬ì˜ëœ ë‹¨í¸ ì˜í™” 'ë°±! ìŠ¤í…Œì´ì§€'ì˜ ëŸ¬ë‹íƒ€ì„ì€?", options: ["18ë¶„", "20ë¶„", "22ë¶„", "25ë¶„"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304852" },
        { question: "'ë°±! ìŠ¤í…Œì´ì§€'ì˜ ì£¼ì—° ë°°ìš°ëŠ” ëˆ„êµ¬ì¸ê°€ìš”?", options: ["ATEEZ ìœ¤í˜¸", "ATEEZ í™ì¤‘", "ATEEZ ì„±í™”", "ATEEZ ìš°ì˜"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304852" },
        { question: "ì˜í™” 'ì¢€ë¹„ë”¸'ì´ ê°œë´‰ 6ì¼ ë§Œì— ëŒíŒŒí•œ ê´€ê° ìˆ˜ëŠ”?", options: ["150ë§Œ", "200ë§Œ", "250ë§Œ", "300ë§Œ"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304846" },
        { question: "'ì¢€ë¹„ë”¸'ì—ì„œ ì‹ ìŠ¤í‹¸ëŸ¬ ì—­í• ì„ í•˜ëŠ” ê³ ì–‘ì´ì˜ ì´ë¦„ì€?", options: ["ì• ìš©ì´", "ì‚¬ë‘ì´", "ê·€ì—¼ì´", "ì˜ˆì¨ì´"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304846" }
      ],
      'ë®¤ì§': [
        { question: "ì„ ë¯¸ì˜ ì´ë²ˆ ì»´ë°±ì€ ì´ì „ ì‹±ê¸€ 'Balloon in Love' ë°œí‘œ í›„ ì–¼ë§ˆ ë§Œì¸ê°€ìš”?", options: ["6ê°œì›” ë§Œ", "1ë…„ ë§Œ", "1ë…„ 2ê°œì›” ë§Œ", "1ë…„ 6ê°œì›” ë§Œ"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304833" },
        { question: "ì„ ë¯¸ì˜ ì‹ ê³¡ì€ ì–¸ì œ ê³µê°œë˜ë‚˜ìš”?", options: ["8ì›” 24ì¼ ì˜¤í›„ 6ì‹œ", "8ì›” 25ì¼ ì˜¤í›„ 6ì‹œ", "8ì›” 26ì¼ ì˜¤í›„ 6ì‹œ", "8ì›” 27ì¼ ì˜¤í›„ 6ì‹œ"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304833" },
        { question: "ì•„ì´ìœ ì˜ íŒ¬ë°‹ì—… 'Bye, Summer'ê°€ ê°œìµœë˜ëŠ” ì¥ì†ŒëŠ”?", options: ["ì˜¬ë¦¼í”½ê³µì›", "KSPO DOME", "ì ì‹¤ì‹¤ë‚´ì²´ìœ¡ê´€", "ê³ ì²™ìŠ¤ì¹´ì´ë”"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304843" },
        { question: "ì•„ì´ìœ  íŒ¬ë°‹ì—…ì€ ëª‡ ë…„ ë§Œì˜ ì˜¤í”„ë¼ì¸ ê³µì‹ íŒ¬í–‰ì‚¬ì¸ê°€ìš”?", options: ["1ë…„ ë§Œ", "2ë…„ ë§Œ", "3ë…„ ë§Œ", "4ë…„ ë§Œ"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304843" },
        { question: "ë¹…íˆíŠ¸ ë®¤ì§ì˜ ì‹ ì¸ ë³´ì´ê·¸ë£¹ 'ì½”ë¥´í‹°ìŠ¤(CORTIS)'ëŠ” ëª‡ ì¸ì¡° ê·¸ë£¹ì¸ê°€ìš”?", options: ["4ì¸ì¡°", "5ì¸ì¡°", "6ì¸ì¡°", "7ì¸ì¡°"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304759" },
        { question: "'ì½”ë¥´í‹°ìŠ¤(CORTIS)'ì˜ ë°ë·” ì˜ˆì •ì¼ì€ ì–¸ì œì¸ê°€ìš”?", options: ["8ì›” 15ì¼", "8ì›” 18ì¼", "8ì›” 20ì¼", "8ì›” 25ì¼"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304759" }
      ],
      'ìŠ¤íƒ€': [
        { question: "ë°•ì§„ì£¼ê°€ ì¶œì—°í•˜ëŠ” ë“œë¼ë§ˆ 'ë‚´ ë”¸ ì¹œêµ¬ì˜ ì—„ë§ˆ'ì—ì„œ ë°•ì§„ì£¼ê°€ ë§¡ì€ ì—­í• ì˜ ì´ë¦„ì€?", options: ["ê¹€í¬ì§„", "ì„œí¬ì§„", "ë°•í¬ì§„", "ì´í¬ì§„"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304724" },
        { question: "'O'PENing 2025'ëŠ” ì–¸ì œ ì²« ë°©ì†¡ë˜ë‚˜ìš”?", options: ["8ì›” 15ì¼", "8ì›” 16ì¼", "8ì›” 17ì¼", "8ì›” 18ì¼"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304724" },
        { question: "ì°¨ì¸í‘œê°€ ìˆ˜ìƒí•œ ë¬¸í•™ìƒì€ ë¬´ì—‡ì¸ê°€ìš”?", options: ["ì´ìƒë¬¸í•™ìƒ", "í™©ìˆœì›ë¬¸í•™ìƒ", "ê¹€ìœ ì •ë¬¸í•™ìƒ", "í˜„ëŒ€ë¬¸í•™ìƒ"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304680" },
        { question: "ì°¨ì¸í‘œì˜ ìˆ˜ìƒì‘ ì†Œì„¤ ì œëª©ì€ ë¬´ì—‡ì¸ê°€ìš”?", options: ["ë°”ë‹¤ì‚¬ëƒ¥", "ì¸ì–´ì‚¬ëƒ¥", "ë¬¼ê³ ê¸°ì‚¬ëƒ¥", "ê³ ë˜ì‚¬ëƒ¥"], correct: 1, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304680" },
        { question: "ì°¨ì£¼ì˜ì´ ì„œê²½ë• êµìˆ˜ì™€ ì œì‘í•œ ê´‘ë³µ 80ì£¼ë…„ ê¸°ë… ì˜ìƒì˜ ì œëª©ì€?", options: ["ë¹›ì„ ë‹´ì€ í•­ì¼ìœ ì‚°", "ì—­ì‚¬ë¥¼ ë‹´ì€ í•­ì¼ìœ ì‚°", "í¬ë§ì„ ë‹´ì€ í•­ì¼ìœ ì‚°", "ì •ì‹ ì„ ë‹´ì€ í•­ì¼ìœ ì‚°"], correct: 0, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304669" },
        { question: "ì°¨ì£¼ì˜ì˜ ê´‘ë³µ 80ì£¼ë…„ ê¸°ë… ì˜ìƒì˜ ëŸ¬ë‹íƒ€ì„ì€?", options: ["3ë¶„ 30ì´ˆ", "4ë¶„", "4ë¶„ 30ì´ˆ", "5ë¶„"], correct: 2, hint: "https://ent.sbs.co.kr/news/article.do?article_id=E10010304669" }
      ]
    };

    let currentCategory = '';
    let currentQuestionIndex = 0;
    let currentQuestions = [];
    let answered = false;
    let userNickname = '';
    let correctAnswers = 0;

    let rankings = JSON.parse(localStorage.getItem('quizRankings') || '[]');
    if (!Array.isArray(rankings) || rankings.length === 0) {
      rankings = [
        { nickname: "ë¯¼ìˆ˜", category: "ë°©ì†¡", score: 95 },
        { nickname: "ì§€ì˜", category: "ì˜í™”", score: 90 },
        { nickname: "ì² ìˆ˜", category: "ë®¤ì§", score: 88 },
        { nickname: "ì˜í¬", category: "ìŠ¤íƒ€", score: 85 },
        { nickname: "í•˜ì¤€", category: "ë°©ì†¡", score: 82 },
        { nickname: "ìˆ˜ë¹ˆ", category: "ì˜í™”", score: 80 }
      ];
      localStorage.setItem('quizRankings', JSON.stringify(rankings));
    }
    let totalParticipants = Number(localStorage.getItem('totalParticipants') || '150');
    localStorage.setItem('totalParticipants', String(totalParticipants));

    function updateHomeBoards() {
      $('totalParticipants').textContent = String(totalParticipants);
      const board = $('homeRankingBoard');
      if (!rankings.length) {
        board.textContent = 'ì•„ì§ ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
      } else {
        board.innerHTML = rankings.slice(0, 5).map((r, i) => {
          const medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1) + 'ìœ„';
          return `<div class="flex items-center justify-between gap-2 py-2 px-3 rounded-lg bg-gray-50">
            <span class="font-semibold">${medal}</span>
            <span class="flex-1 text-center">${r.nickname}</span>
            <span class="text-sm text-gray-500">${r.score}ì </span>
          </div>`;
        }).join('');
      }
    }

    // ê´€ë¦¬ìê°€ ë§Œë“  í€´ì¦ˆ(í™œì„±) ìš°ì„  ì‚¬ìš©
    function getAdminQuizzesByCategory(category){
      const arts = readArticles().filter(a => a.active && a.category===category && Array.isArray(a.quizzes) && a.quizzes.length);
      const qs = [];
      arts.forEach(a=>{
        a.quizzes.forEach(q=>{
          if(q.type==='MCQ' && Array.isArray(q.options) && q.options.length>=4){
            qs.push({question:q.question, options:q.options.slice(0,4), correct:Number(q.correct)||0, hint:a.url||''});
          }else if(q.type==='OX'){
            const correct = (String(q.answer||'O').toUpperCase()==='X')?1:0;
            qs.push({question:q.question, options:['O','X'], correct, hint:a.url||''});
          } // SHORTëŠ” ì‚¬ìš©ì í™”ë©´ì—ì„  ê±´ë„ˆëœ€
        });
      });
      return qs;
    }

    function startQuiz(category) {
      currentCategory = category;
      $('selectedCategory').textContent = `${category} í€´ì¦ˆ`;
      hide($('homeScreen')); show($('nicknameScreen'));
      $('nicknameInput').value = ''; $('nicknameInput').focus();
    }

    function pickRandom(list, n) {
      const a = list.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a.slice(0, n);
    }

    function startQuizWithNickname() {
      const nickname = $('nicknameInput').value.trim();
      if (!nickname) { alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
      userNickname = nickname;

      const adminQs = getAdminQuizzesByCategory(currentCategory);
      const need = 6;
      let list = adminQs.slice(0, need);
      if (list.length < need) {
        const fallback = quizData[currentCategory] || [];
        const remain = need - list.length;
        list = list.concat(pickRandom(fallback, remain));
      } else {
        list = pickRandom(list, need);
      }

      currentQuestions = list;
      currentQuestionIndex = 0;
      correctAnswers = 0;

      hide($('nicknameScreen')); show($('quizScreen'));
      $('categoryTitle').textContent = `${currentCategory} í€´ì¦ˆ - ${userNickname}ë‹˜`;

      showQuestion();
    }

    document.addEventListener('DOMContentLoaded', function() {
      updateHomeBoards();
      // ìƒë‹¨ ì¹´ìš´í„° í…ìŠ¤íŠ¸ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
      const qc = $('questionCounter'); if (qc) qc.style.display = 'none';
      $('nicknameInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') startQuizWithNickname();
      });
    });

    function showQuestion() {
      const q = currentQuestions[currentQuestionIndex];
      answered = false;

      const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
      $('progressBar').style.width = `${progress}%`;
      $('progressText').textContent = `${currentQuestionIndex + 1} / ${currentQuestions.length}`;

      $('questionText').textContent = q.question;

      const optionsContainer = $('optionsContainer');
      optionsContainer.innerHTML = '';

      q.options.forEach((opt, idx) => {
        const div = document.createElement('div');
        div.className = 'quiz-option bg-gray-50 hover:bg-gray-100 p-4 rounded-lg cursor-pointer border-2 border-transparent transition-all';
        div.textContent = `${idx + 1}. ${opt}`;
        div.onclick = () => selectAnswer(idx, div);
        optionsContainer.appendChild(div);
      });

      // ì§„í–‰ ì¤‘ì—ëŠ” í—¤ë”/í”„ë¡œê·¸ë ˆìŠ¤ ë³´ì´ê¸°
      show(document.getElementById('quizHeaderRow'));
      show(document.getElementById('quizProgressWrap'));
    }

    function selectAnswer(selectedIndex, el) {
      if (answered) return;
      answered = true;

      const q = currentQuestions[currentQuestionIndex];
      const ok = selectedIndex === q.correct;
      if (ok) correctAnswers++;

      const options = document.querySelectorAll('.quiz-option');
      options.forEach(o => o.style.pointerEvents = 'none');

      options[q.correct].classList.add('border-green-500', 'bg-green-100');
      if (!ok) el.classList.add('border-red-500', 'bg-red-100');

      showTooltip(ok ? 'ì •ë‹µ!' : 'ì˜¤ë‹µ!', ok);
      setTimeout(nextQuestion, 1200);
    }

    function showTooltip(msg, ok) {
      const t = document.createElement('div');
      t.className = `tooltip px-6 py-3 rounded-2xl text-white text-xl font-bold ${ok ? 'bg-green-500' : 'bg-red-500'}`;
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => document.body.removeChild(t), 1100);
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < currentQuestions.length) showQuestion();
      else showCompletionView();
    }

    function scoreMessage(score) {
      if (score >= 90) return "ì™„ë²½í•´ìš”! ì˜¤ëŠ˜ ë‰´ìŠ¤ ë§ˆìŠ¤í„° ğŸ”¥";
      if (score >= 70) return "ì•„ì£¼ ì¢‹ì•„ìš”! í•œ ë—ë§Œ ë” âœ¨";
      if (score >= 50) return "ê´œì°®ì•„ìš”! ì¡°ê¸ˆë§Œ ë” íŒŒê³ ë“¤ë©´ ë©ë‹ˆë‹¤ ğŸ’ª";
      if (score >= 30) return "ì‹œë™ ê±¸ë ¸ì–´ìš”! ë‹¤ìŒì—” ë” ì˜í•  ìˆ˜ ìˆì–´ìš” ğŸš€";
      return "ê´œì°®ì•„ìš”! ê¸°ì‚¬ íŒíŠ¸ë„ ì ê·¹ í™œìš©í•´ë³´ì ğŸ˜Š";
    }

    // í•˜ë‹¨ ë°•ìŠ¤ ë¹Œë”: ë­í‚¹ / ì¸ê¸°ë‰´ìŠ¤ (ê°ê° ë°•ìŠ¤)
    function buildRankingBox(rankingHTML) {
      return `
        <div class="bg-white rounded-2xl shadow p-5">
          <h4 class="text-lg font-bold text-gray-800 mb-3">ğŸ† ì˜¤ëŠ˜ì˜ ë­í‚¹ TOP 10</h4>
          <div class="space-y-2">
            ${rankingHTML}
          </div>
        </div>
      `;
    }
    function buildPopularBox() {
      const howMany = 5;
      const selected = pickRandom(popularArticlesTop10, Math.min(howMany, popularArticlesTop10.length));
      while (selected.length < howMany) selected.push({ title: 'ì½˜í…ì¸  ì¤€ë¹„ ì¤‘', url: '#', placeholder: true });

      const items = selected.map((item) => `
        <a href="${item.url}" target="_blank" rel="noopener" 
           class="block rounded-2xl border border-gray-200 bg-white px-4 py-3 hover:shadow transition kb">
          ${item.title}
        </a>
      `).join('');

      return `
        <div class="bg-white rounded-2xl shadow p-5">
          <h4 class="text-lg font-bold text-gray-800 mb-3">ğŸ”¥ ì˜¤ëŠ˜ì˜ ì¸ê¸°ë‰´ìŠ¤ TOP 5</h4>
          <div class="grid gap-2">
            ${items}
          </div>
        </div>
      `;
    }

    function showCompletionView() {
      const score = Math.round((correctAnswers / currentQuestions.length) * 100);

      totalParticipants += 1;
      localStorage.setItem('totalParticipants', String(totalParticipants));
      rankings.push({ nickname: userNickname, category: currentCategory, score });
      rankings.sort((a, b) => b.score - a.score);
      rankings = rankings.slice(0, 50);
      localStorage.setItem('quizRankings', JSON.stringify(rankings));

      const rankingHTML = rankings.slice(0, 10).map((r, i) => {
        const medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1) + 'ìœ„';
        const me = r.nickname === userNickname ? 'bg-yellow-100' : '';
        return `<div class="flex items-center justify-between gap-2 py-2 px-3 rounded-lg bg-gray-50 ${me}">
          <span class="font-semibold">${medal}</span>
          <span class="flex-1 text-center">${r.nickname}</span>
          <span class="text-sm text-gray-500">${r.score}ì  (${r.category})</span>
        </div>`;
      }).join('');

      // ê²°ê³¼ í™”ë©´: ìƒë‹¨ í—¤ë”/í”„ë¡œê·¸ë ˆìŠ¤ë°” ê°ì¶¤, ì¢Œìƒë‹¨ ë‹¨ë… í™ˆë²„íŠ¼ ì—†ìŒ
      hide(document.getElementById('quizHeaderRow'));
      hide(document.getElementById('quizProgressWrap'));

      const box = $('optionsContainer');
      box.innerHTML = `
        <div class="space-y-6">
          <!-- ë‚´ ê²°ê³¼ ë°•ìŠ¤ -->
          <div class="bg-white rounded-2xl border border-gray-200 shadow p-6 text-center">
            <div class="text-5xl mb-3">ğŸ‰</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-1">${currentCategory} í€´ì¦ˆ ì™„ë£Œ!</h3>
            <p class="text-purple-600 font-bold mb-3">${userNickname}ë‹˜ì˜ ì ìˆ˜: ${score}ì  (${correctAnswers}/${currentQuestions.length})</p>
            <p class="text-gray-600 mb-4 kb">${scoreMessage(score)}</p>
            <div class="flex items-center justify-center gap-2 flex-wrap">
              <button onclick="retryQuiz()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">ë‹¤ì‹œ í’€ê¸°</button>
              <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">í™ˆìœ¼ë¡œ ê°€ê¸°</button>
            </div>
          </div>

          <!-- í•˜ë‹¨: ì¢Œìš° 5:5 -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              ${buildRankingBox(rankingHTML)}
            </div>
            <div>
              ${buildPopularBox()}
            </div>
          </div>
        </div>
      `;

      // ë¬¸ì œ ë³¸ë¬¸/íŒíŠ¸ ë²„íŠ¼ ê°ì¶¤
      $('questionText').textContent = '';
      $('hintBtn').style.display = 'none';

      updateHomeBoards();
    }

    function retryQuiz() {
      // í—¤ë”/í”„ë¡œê·¸ë ˆìŠ¤ ë³µì›
      show(document.getElementById('quizHeaderRow'));
      show(document.getElementById('quizProgressWrap'));

      const adminQs = getAdminQuizzesByCategory(currentCategory);
      const need = 6;
      let list = adminQs.slice(0, need);
      if (list.length < need) {
        const fallback = quizData[currentCategory] || [];
        const remain = need - list.length;
        list = list.concat(pickRandom(fallback, remain));
      } else {
        list = pickRandom(list, need);
      }
      currentQuestions = list;
      currentQuestionIndex = 0;
      correctAnswers = 0;
      $('hintBtn').style.display = 'inline-flex';
      showQuestion();
    }

    function showHint() {
      const q = currentQuestions[currentQuestionIndex];
      if (q && q.hint) window.open(q.hint, '_blank');
    }

    function goHome() {
      hide($('quizScreen')); hide($('nicknameScreen')); show($('homeScreen'));
      $('hintBtn').style.display = 'inline-flex';
      show(document.getElementById('quizHeaderRow'));
      show(document.getElementById('quizProgressWrap'));
      updateHomeBoards();
    }

    // ê´€ë¦¬ì/ì‚¬ìš©ì ì „í™˜ ë²„íŠ¼
    $('btnGoAdmin').addEventListener('click', ()=>{
      hide($('homeScreen')); hide($('nicknameScreen')); hide($('quizScreen'));
      show($('adminWrap'));
      hide($('btnGoAdmin')); show($('btnGoUser'));
      if(localStorage.getItem('logged_demo')==='1'){ showList(); } else { showLogin(); }
    });
    $('btnGoUser').addEventListener('click', ()=>{
      show($('homeScreen'));
      hide($('adminWrap'));
      show($('btnGoAdmin')); hide($('btnGoUser'));
    });

    /* ===================== ê´€ë¦¬ì ë¡œì§ ===================== */
    let editingIndex = null;
    let createPreviewQuizzes = [];

    function showLogin(){
      show($('loginScreen')); hide($('listScreen')); hide($('createScreen')); hide($('editScreen')); hide($('settingsScreen'));
      $('logoutBtn').classList.add('hidden');
    }
    function showList(){
      hide($('loginScreen')); show($('listScreen')); hide($('createScreen')); hide($('editScreen')); hide($('settingsScreen'));
      $('logoutBtn').classList.remove('hidden');
      renderList();
    }
    function showCreate(){
      hide($('loginScreen')); hide($('listScreen')); show($('createScreen')); hide($('editScreen')); hide($('settingsScreen'));
    }
    function showEdit(){
      hide($('loginScreen')); hide($('listScreen')); hide($('createScreen')); show($('editScreen')); hide($('settingsScreen'));
    }

    // ë¡œê·¸ì¸
    $('loginForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const id=$('loginId').value.trim(), pw=$('loginPw').value.trim();
      if(id===VALID_ID && pw===VALID_PW){ localStorage.setItem('logged_demo','1'); showList(); }
      else alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });
    $('logoutBtn').addEventListener('click', ()=>{ localStorage.removeItem('logged_demo'); showLogin(); });

    // ì„¤ì • í™”ë©´
    $('settingsBtn').addEventListener('click', ()=>{
      hide($('loginScreen')); hide($('listScreen')); hide($('createScreen')); hide($('editScreen'));
      show($('settingsScreen'));
      $('gptApiKeyInput').value = localStorage.getItem('gpt_api_key') || '';
    });
    $('backToListBtnSettings').addEventListener('click', showList);
    $('saveGptKeyBtn').addEventListener('click', ()=>{
      const v = $('gptApiKeyInput').value.trim();
      if(!v){ alert('API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      localStorage.setItem('gpt_api_key', v);
      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    // ëª©ë¡ ë Œë”
    function renderList(){
      const onlyActive = $('filterActive').checked;
      const tb = $('quizList'); tb.innerHTML='';
      const list = readArticles();
      list.forEach((a,i)=>{
        if(onlyActive && !a.active) return;
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td class="p-3 align-top">
            <a href="#" data-i="${i}" class="text-indigo-600 hover:underline font-semibold">${a.title||'(ì œëª© ì—†ìŒ)'}</a>
            <div class="text-xs text-gray-500">${a.url||''}</div>
          </td>
          <td class="p-3 align-top">${a.category||''}</td>
          <td class="p-3 align-top">${a.active?'<span class="badge on">ì‚¬ìš©</span>':'<span class="badge off">ë¯¸ì‚¬ìš©</span>'}</td>
          <td class="p-3 align-top"><button class="px-3 py-1 rounded bg-red-500 text-white text-xs" data-del="${i}">ì‚­ì œ</button></td>
        `;
        tb.appendChild(tr);
      });
      tb.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const idx=+btn.getAttribute('data-del');
          if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
            const arr = readArticles(); arr.splice(idx,1); writeArticles(arr); renderList();
          }
        });
      });
      tb.querySelectorAll('a[data-i]').forEach(a=>{
        a.addEventListener('click',(e)=>{
          e.preventDefault();
          openEdit(+a.getAttribute('data-i'));
        });
      });
    }
    $('filterActive').addEventListener('change', renderList);

    // ìƒì„± í™”ë©´ ì§„ì…/ë‚˜ê°€ê¸°
    $('createQuizBtn').addEventListener('click', ()=>{
      $('createUse').checked = true;
      $('createCategory').value = 'ë°©ì†¡';
      $('createTitle').value=''; $('createUrl').value=''; $('createContent').value='';
      createPreviewQuizzes = []; $('createPreview').innerHTML=''; $('createActions').classList.add('hidden');
      showCreate();
    });
    $('backToListBtn1').addEventListener('click', showList);
    $('backToListBtn2').addEventListener('click', showList);

    // ë”ë¯¸ í€´ì¦ˆ ìƒì„±ê¸° (í‚¤ ì—†ì´ í…ŒìŠ¤íŠ¸ìš©)
    function dummyQuizzes(category, content, count){
      const pool = [
        {type:'MCQ', question:`${category} ê¸°ì‚¬ í•µì‹¬ì€ ë¬´ì—‡ì¸ê°€ìš”?`, options:['ìƒˆ ë°œí‘œ','ìˆ˜ìƒ','íˆ¬ì–´ ì¼ì •','ë…¼ë€'], correct:0, explanation:'ë³¸ë¬¸ ìš”ì•½'},
        {type:'OX', question:`ë³¸ë¬¸ì— ì¼ì •ì´ ì–¸ê¸‰ë˜ì—ˆë‚˜ìš”?`, answer:'O', explanation:'ì²« ë¬¸ë‹¨'},
        {type:'MCQ', question:`í–¥í›„ ê³„íšìœ¼ë¡œ ë§ëŠ” ê²ƒì€?`, options:['íŒŒíŠ¸2 ê³µê°œ','í™œë™ ì¤‘ë‹¨','í•´ì™¸ ì´ì£¼','íœ´ì‹'], correct:0, explanation:'í›„ë°˜ë¶€'}
      ];
      const out=[]; while(out.length<count){ out.push(JSON.parse(JSON.stringify(pool[Math.floor(Math.random()*pool.length)]))); }
      return out;
    }

    function renderQuizCards(containerId, quizzes, withCheckbox){
      const host=$(containerId); host.innerHTML='';
      quizzes.forEach((q,i)=>{
        const card=document.createElement('div');
        card.className='border border-gray-200 rounded-xl p-3';
        let head = (withCheckbox?`<input type="checkbox" data-i="${i}" class="mr-2">`:'') + `<b>Q${i+1}.</b> ${q.question||'(ì§ˆë¬¸ ì—†ìŒ)'}`;
        card.innerHTML = `<div class="mb-2">${head}</div>`;
        if(q.type==='MCQ'){
          const labs=['A','B','C','D']; const opts=(q.options||[]).slice(0,4);
          card.innerHTML += opts.map((o,idx)=>`
            <div class="flex items-center gap-2 text-sm border rounded-lg px-2 py-1 mb-1 ${idx===(q.correct||0)?'border-green-300 bg-green-50':''}">
              <span class="inline-flex w-6 h-6 items-center justify-center rounded-full bg-indigo-50 font-bold">${labs[idx]}</span>
              <span>${o||''}</span>
            </div>`).join('');
        }else if(q.type==='OX'){
          const ans = (String(q.answer||'O').toUpperCase()==='X')?'X':'O';
          ['O','X'].forEach(v=>{
            card.innerHTML += `
              <div class="inline-flex items-center gap-2 text-sm border rounded-lg px-3 py-1 mr-2 ${ans===v?'border-green-300 bg-green-50':''}">
                <span class="inline-flex w-6 h-6 items-center justify-center rounded-full bg-indigo-50 font-bold">${v}</span>
              </div>`;
          });
        }else{ // SHORT â†’ í‘œì‹œë§Œ
          card.innerHTML += `<div class="text-sm text-slate-700"><b>ì •ë‹µ(ë‹¨ë‹µ)</b>: ${q.answer||''}</div>`;
        }
        if(q.explanation){ card.innerHTML += `<div class="text-xs text-slate-500 mt-1">í•´ì„¤: ${q.explanation}</div>`; }
        host.appendChild(card);
      });
    }
    function getCheckedIndices(containerId){
      return Array.from(document.querySelectorAll('#'+containerId+' input[type=checkbox]')).filter(x=>x.checked).map(x=>+x.getAttribute('data-i'));
    }

    // ìƒì„± í™”ë©´: í€´ì¦ˆ ìƒì„± (GPT ì‹œë„ â†’ ì‹¤íŒ¨ ì‹œ ë”ë¯¸ í´ë°±)
    $('createGenerate').addEventListener('click', async ()=>{
      const content = $('createContent').value.trim();
      if(!content){ alert('ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }

      const category = $('createCategory').value;
      const key = localStorage.getItem('gpt_api_key');

      async function generateViaGPT(cat, body){
        if(!key) return null;
        try{
          const sys = "You are a quiz generator for Korean entertainment news. Output STRICT JSON with {\"quizzes\":[...]} containing exactly 2 items. Each item: either {\"type\":\"MCQ\",\"question\":\"...\",\"options\":[\"A\",\"B\",\"C\",\"D\"],\"correct\":0-3,\"explanation\":\"...\"} or {\"type\":\"OX\",\"question\":\"...\",\"answer\":\"O\"|\"X\",\"explanation\":\"...\"}. No extra text.";
          const usr = `ì¹´í…Œê³ ë¦¬: ${cat}\në‹¤ìŒ ê¸°ì‚¬ ë³¸ë¬¸ì„ ë°”íƒ•ìœ¼ë¡œ í€´ì¦ˆ 2ê°œë¥¼ ìƒì„±í•´ì¤˜.\në³¸ë¬¸:\n${body}`;

          const res = await fetch("https://api.openai.com/v1/chat/completions",{
            method:"POST",
            headers:{
              "Content-Type":"application/json",
              "Authorization":`Bearer ${key}`
            },
            body: JSON.stringify({
              model: "gpt-4o-mini",
              messages: [
                {role:"system", content: sys},
                {role:"user", content: usr}
              ],
              temperature: 0.4,
              response_format: { type: "json_object" }
            })
          });

          if(!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          const text = data.choices?.[0]?.message?.content || "";
          const parsed = JSON.parse(text);
          const out = parsed.quizzes || null;
          if(!Array.isArray(out) || out.length < 2) return null;
          return out;
        }catch(e){
          console.warn("GPT í˜¸ì¶œ ì‹¤íŒ¨:", e);
          return null;
        }
      }

      let qs = await generateViaGPT(category, content);
      if(!qs){
        qs = dummyQuizzes(category, content, 2);
      }

      createPreviewQuizzes = qs;
      renderQuizCards('createPreview', createPreviewQuizzes, true);
      $('createActions').classList.remove('hidden');
    });

    // ìƒì„± í™”ë©´: ë“±ë¡
    $('createRegister').addEventListener('click', ()=>{
      const selected = getCheckedIndices('createPreview');
      if(!selected.length){ alert('ë“±ë¡í•  í€´ì¦ˆë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
      const a = {
        title: $('createTitle').value || $('createContent').value.slice(0,30),
        category: $('createCategory').value,
        active: $('createUse').checked,
        url: $('createUrl').value,
        content: $('createContent').value,
        quizzes: selected.map(i=>createPreviewQuizzes[i])
      };
      const arr = readArticles(); arr.push(a); writeArticles(arr);
      showList();
    });

    // ìƒì„± í™”ë©´: ì„ íƒ ì¬ìƒì„±
    $('createRegen').addEventListener('click', ()=>{
      const selected = getCheckedIndices('createPreview');
      if(!selected.length){ alert('ë‹¤ì‹œ ìƒì„±í•  í€´ì¦ˆë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
      const content = $('createContent').value.trim();
      const fresh = dummyQuizzes($('createCategory').value, content, selected.length);
      selected.forEach((idx,k)=>{ createPreviewQuizzes[idx] = fresh[k]; });
      renderQuizCards('createPreview', createPreviewQuizzes, true);
    });

    // í¸ì§‘
    function openEdit(index){
      editingIndex = index;
      const a = readArticles()[index];
      $('editCategory').value = a.category||'ë°©ì†¡';
      $('editTitle').value = a.title||'';
      $('editUrl').value = a.url||'';
      $('editContent').value = a.content||'';
      $('editUse').checked = !!a.active;
      renderQuizCards('appliedList', a.quizzes||[], true);
      showEdit();
    }

    $('editRegenSelected').addEventListener('click', ()=>{
      const arr = readArticles();
      const a = arr[editingIndex];
      const selected = getCheckedIndices('appliedList');
      if(!selected.length){ alert('ë‹¤ì‹œ ìƒì„±í•  í€´ì¦ˆë¥¼ ì„ íƒí•˜ì„¸ìš”'); return; }
      const fresh = dummyQuizzes(a.category, a.content, selected.length);
      selected.forEach((idx,k)=>{ a.quizzes[idx] = fresh[k]; });
      writeArticles(arr);
      renderQuizCards('appliedList', a.quizzes, true);
    });

    $('saveArticleBtn').addEventListener('click', ()=>{
      const arr = readArticles();
      const a = arr[editingIndex];
      a.category = $('editCategory').value;
      a.title = $('editTitle').value;
      a.url = $('editUrl').value;
      a.content = $('editContent').value;
      a.active = $('editUse').checked;
      writeArticles(arr);
      alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      showList();
    });

  </script>
</body>
</html>
